const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/browser-wb85aNMu.js","assets/react-vendor-B1Vxq2-Z.js"])))=>i.map(i=>d[i]);
import{r as m,a as jr,c as Z,R as v,L as pe,u as ws,b as Ln,d as Un,e as $n,N as Dn,B as Mn,f as zn,h as Ye}from"./react-vendor-B1Vxq2-Z.js";import{M as Fn,S as Bn,L as Wn,a as ks,C as Pt,b as Vn,c as Ot,P as Sr,H as Tt,d as xs,A as Er,X as qs,e as qn,f as Hn,G as Gn,J as X,g as Hs,h as Kn,i as Jn,T as Yn}from"./ui-DXFvBzEj.js";import{M as Qn,a as Gs,_ as We,m as Xn}from"./mapbox-Bv8gB9cj.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();var Cr={exports:{}},Nt={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Zn=m,ei=Symbol.for("react.element"),ti=Symbol.for("react.fragment"),si=Object.prototype.hasOwnProperty,ri=Zn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ni={key:!0,ref:!0,__self:!0,__source:!0};function Pr(s,e,t){var r,i={},n=null,o=null;t!==void 0&&(n=""+t),e.key!==void 0&&(n=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)si.call(e,r)&&!ni.hasOwnProperty(r)&&(i[r]=e[r]);if(s&&s.defaultProps)for(r in e=s.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:ei,type:s,key:n,ref:o,props:i,_owner:ri.current}}Nt.Fragment=ti;Nt.jsx=Pr;Nt.jsxs=Pr;Cr.exports=Nt;var c=Cr.exports,os={},Ks=jr;os.createRoot=Ks.createRoot,os.hydrateRoot=Ks.hydrateRoot;var js=(s,e,t)=>{if(!e.has(s))throw TypeError("Cannot "+t)},y=(s,e,t)=>(js(s,e,"read from private field"),t?t.call(s):e.get(s)),Pe=(s,e,t)=>{if(e.has(s))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(s):e.set(s,t)},Ee=(s,e,t,r)=>(js(s,e,"write to private field"),e.set(s,t),t),ii=(s,e,t)=>(js(s,e,"access private method"),t);typeof window<"u"&&!window.global&&(window.global=typeof Z>"u"?window:Z);var Or=s=>typeof atob<"u"&&typeof atob=="function"?atob(s):typeof global<"u"&&global.Buffer?new global.Buffer(s,"base64").toString():s,Tr="pk_live_",oi="pk_test_";function Js(s){if(s=s||"",!Nr(s))return null;const e=s.startsWith(Tr)?"production":"development";let t=Or(s.split("_")[2]);return t.endsWith("$")?(t=t.slice(0,-1),{instanceType:e,frontendApi:t}):null}function Nr(s){s=s||"";const e=s.startsWith(Tr)||s.startsWith(oi),t=Or(s.split("_")[2]||"").endsWith("$");return e&&t}function ai(s){return s=s||"",s.startsWith("clerk.")}function li(){const s=[".lcl.dev",".stg.dev",".lclstage.dev",".stgstage.dev",".dev.lclclerk.com",".stg.lclclerk.com",".accounts.lclclerk.com","accountsstage.dev","accounts.dev"],e=new Map;return{isDevOrStagingUrl:t=>{if(!t)return!1;const r=typeof t=="string"?t:t.hostname;let i=e.get(r);return i===void 0&&(i=s.some(n=>r.endsWith(n)),e.set(r,i)),i}}}var Rr=Object.defineProperty,ci=Object.getOwnPropertyDescriptor,ui=Object.getOwnPropertyNames,di=Object.prototype.hasOwnProperty,hi=(s,e)=>{for(var t in e)Rr(s,t,{get:e[t],enumerable:!0})},fi=(s,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of ui(e))!di.call(s,i)&&i!==t&&Rr(s,i,{get:()=>e[i],enumerable:!(r=ci(e,i))||r.enumerable});return s},pi=(s,e,t)=>(fi(s,e,"default"),t),gi=()=>{try{return!1}catch{}return!1},mi=()=>{try{return!1}catch{}return!1},vi=()=>{try{return!0}catch{}return!1},Ys=new Set,Et=(s,e,t)=>{const r=mi()||vi(),i=s;Ys.has(i)||r||(Ys.add(i),console.warn(`Clerk - DEPRECATION WARNING: "${s}" is deprecated and will be removed in the next major release.
${e}`))},bi={Expired:"expired",Failed:"failed"};new Proxy(bi,{get(s,e,t){return Et("MagicLinkErrorCode","Use `EmailLinkErrorCode` instead."),Reflect.get(s,e,t)}});var _i=Object.freeze({InvalidFrontendApiErrorMessage:"The frontendApi passed to Clerk is invalid. You can get your Frontend API key at https://dashboard.clerk.com/last-active?path=api-keys. (key={{key}})",InvalidProxyUrlErrorMessage:"The proxyUrl passed to Clerk is invalid. The expected value for proxyUrl is an absolute URL or a relative path with a leading '/'. (key={{url}})",InvalidPublishableKeyErrorMessage:"The publishableKey passed to Clerk is invalid. You can get your Publishable key at https://dashboard.clerk.com/last-active?path=api-keys. (key={{key}})",MissingPublishableKeyErrorMessage:"Missing publishableKey. You can get your key at https://dashboard.clerk.com/last-active?path=api-keys."});function yi({packageName:s,customMessages:e}){let t=s;const r={..._i,...e};function i(n,o){if(!o)return`${t}: ${n}`;let a=n;const l=n.matchAll(/{{([a-zA-Z0-9-_]+)}}/g);for(const d of l){const u=(o[d[1]]||"").toString();a=a.replace(`{{${d[1]}}}`,u)}return`${t}: ${a}`}return{setPackageName({packageName:n}){return typeof n=="string"&&(t=n),this},setMessages({customMessages:n}){return Object.assign(r,n||{}),this},throwInvalidPublishableKeyError(n){throw new Error(i(r.InvalidPublishableKeyErrorMessage,n))},throwInvalidFrontendApiError(n){throw new Error(i(r.InvalidFrontendApiErrorMessage,n))},throwInvalidProxyUrl(n){throw new Error(i(r.InvalidProxyUrlErrorMessage,n))},throwMissingPublishableKeyError(){throw new Error(i(r.MissingPublishableKeyErrorMessage))}}}const wi="Clerk: You must wrap your application in a <ClerkProvider> component.",ki="Clerk: You've added multiple <ClerkProvider> components in your React component tree. Wrap your components in a single <ClerkProvider>.",xi="Clerk: Invalid state. Feel free to submit a bug or reach out to support here: https://clerk.com/support",Vt="Clerk: Unsupported usage of isSatellite, domain or proxyUrl. The usage of isSatellite, domain or proxyUrl as function is not supported in non-browser environments.",ji="Clerk: <UserProfile.Page /> component needs to be a direct child of `<UserProfile />` or `<UserButton />`.",Si="Clerk: <UserProfile.Link /> component needs to be a direct child of `<UserProfile />` or `<UserButton />`.",Ei="Clerk: <OrganizationProfile.Page /> component needs to be a direct child of `<OrganizationProfile />` or `<OrganizationSwitcher />`.",Ci="Clerk: <OrganizationProfile.Link /> component needs to be a direct child of `<OrganizationProfile />` or `<OrganizationSwitcher />`.",Pi=s=>`Clerk: <${s} /> can only accept <${s}.Page /> and <${s}.Link /> as its children. Any other provided component will be ignored.`,Oi=s=>`Clerk: Missing props. <${s}.Page /> component requires the following props: url, label, labelIcon, alongside with children to be rendered inside the page.`,Ti=s=>`Clerk: Missing props. <${s}.Link /> component requires the following props: url, label and labelIcon.`,Ni='Clerk: Missing parameters. `has` from `useAuth` requires a permission or role key to be passed. Example usage: `has({permission: "org:posts:edit"`',rt=yi({packageName:"@clerk/react"});function Ri(s){rt.setMessages(s).setPackageName(s)}function Ai(s){return typeof s=="function"}var Ii="loadScript cannot be called when document does not exist",Li="loadScript cannot be called without a src";async function Ui(s="",e){const{async:t,defer:r,beforeLoad:i,crossOrigin:n}=e||{};return new Promise((o,a)=>{s||a(Li),(!document||!document.body)&&a(Ii);const l=document.createElement("script");n&&l.setAttribute("crossorigin",n),l.async=t||!1,l.defer=r||!1,l.addEventListener("load",()=>{l.remove(),o(l)}),l.addEventListener("error",()=>{l.remove(),a()}),l.src=s,i==null||i(l),document.body.appendChild(l)})}function $i(s){return s?Di(s)||Ar(s):!0}function Di(s){return/^http(s)?:\/\//.test(s||"")}function Ar(s){return s.startsWith("/")}function Mi(s){return s?Ar(s)?new URL(s,window.location.origin).toString():s:""}function zi(s){if(!s)return"";let e;if(s.match(/^(clerk\.)+\w*$/))e=/(clerk\.)*(?=clerk\.)/;else{if(s.match(/\.clerk.accounts/))return s;e=/^(clerk\.)*/gi}return`clerk.${s.replace(e,"")}`}const{isDevOrStagingUrl:Fi}=li(),Bi=s=>{if(s)return s;const e=Wi("4.32.4");return e?e==="snapshot"?"4.73.9":e:Vi("4.32.4")},Wi=s=>{var e;return(e=s.match(/-(.*)\./))==null?void 0:e[1]},Vi=s=>s.split(".")[0],qi="Clerk: Failed to load Clerk",Hi=s=>{const{frontendApi:e,publishableKey:t}=s;return!t&&!e&&rt.throwMissingPublishableKeyError(),Ui(Gi(s),{async:!0,crossOrigin:"anonymous",beforeLoad:Ki(s)}).catch(()=>{throw new Error(qi)})},Gi=s=>{var e,t;const{clerkJSUrl:r,clerkJSVariant:i,clerkJSVersion:n,proxyUrl:o,domain:a,publishableKey:l,frontendApi:d}=s;if(r)return r;let u="";o&&$i(o)?u=Mi(o).replace(/http(s)?:\/\//,""):a&&!Fi(((e=Js(l))==null?void 0:e.frontendApi)||d||"")?u=zi(a):u=((t=Js(l))==null?void 0:t.frontendApi)||d||"";const h=i?`${i.replace(/\.+$/,"")}.`:"",f=Bi(n);return`https://${u}/npm/@clerk/clerk-js@${f}/dist/clerk.${h}browser.js`},Ki=s=>e=>{const{publishableKey:t,frontendApi:r,proxyUrl:i,domain:n}=s;t?e.setAttribute("data-clerk-publishable-key",t):r&&e.setAttribute("data-clerk-frontend-api",r),i&&e.setAttribute("data-clerk-proxy-url",i),n&&e.setAttribute("data-clerk-domain",n)},gt=new Map;function Ji(s,e,t=1){v.useEffect(()=>{const r=gt.get(s)||0;if(r==t)throw new Error(e);return gt.set(s,r+1),()=>{gt.set(s,(gt.get(s)||1)-1)}},[])}function Yi(s,e,t){const r=s.displayName||s.name||e||"Component",i=n=>(Ji(e,t),v.createElement(s,{...n}));return i.displayName=`withMaxAllowedInstancesGuard(${r})`,i}const qt=s=>{const e=Array(s.length).fill(null),[t,r]=m.useState(e);return s.map((i,n)=>({id:i.id,mount:o=>r(a=>a.map((l,d)=>d===n?o:l)),unmount:()=>r(o=>o.map((a,l)=>l===n?null:a)),portal:()=>v.createElement(v.Fragment,null,t[n]?jr.createPortal(i.component,t[n]):null)}))};function Ht(s,e,t){if(typeof s=="function")return s(e);if(typeof s<"u")return s;if(typeof t<"u")return t}function Qs(){return typeof window<"u"}var Ae=s=>{gi()&&console.error(s)},Ir={exports:{}},Lr={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ve=m;function Qi(s,e){return s===e&&(s!==0||1/s===1/e)||s!==s&&e!==e}var Xi=typeof Object.is=="function"?Object.is:Qi,Zi=Ve.useState,eo=Ve.useEffect,to=Ve.useLayoutEffect,so=Ve.useDebugValue;function ro(s,e){var t=e(),r=Zi({inst:{value:t,getSnapshot:e}}),i=r[0].inst,n=r[1];return to(function(){i.value=t,i.getSnapshot=e,Gt(i)&&n({inst:i})},[s,t,e]),eo(function(){return Gt(i)&&n({inst:i}),s(function(){Gt(i)&&n({inst:i})})},[s]),so(t),t}function Gt(s){var e=s.getSnapshot;s=s.value;try{var t=e();return!Xi(s,t)}catch{return!0}}function no(s,e){return e()}var io=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?no:ro;Lr.useSyncExternalStore=Ve.useSyncExternalStore!==void 0?Ve.useSyncExternalStore:io;Ir.exports=Lr;var Ur=Ir.exports;const xe=()=>{},K=xe(),xt=Object,S=s=>s===K,le=s=>typeof s=="function",ge=(s,e)=>({...s,...e}),oo=s=>le(s.then),mt=new WeakMap;let ao=0;const at=s=>{const e=typeof s,t=s&&s.constructor,r=t==Date;let i,n;if(xt(s)===s&&!r&&t!=RegExp){if(i=mt.get(s),i)return i;if(i=++ao+"~",mt.set(s,i),t==Array){for(i="@",n=0;n<s.length;n++)i+=at(s[n])+",";mt.set(s,i)}if(t==xt){i="#";const o=xt.keys(s).sort();for(;!S(n=o.pop());)S(s[n])||(i+=n+":"+at(s[n])+",");mt.set(s,i)}}else i=r?s.toJSON():e=="symbol"?s.toString():e=="string"?JSON.stringify(s):""+s;return i},ue=new WeakMap,Kt={},vt={},Ss="undefined",Rt=typeof window!=Ss,as=typeof document!=Ss,lo=()=>Rt&&typeof window.requestAnimationFrame!=Ss,ye=(s,e)=>{const t=ue.get(s);return[()=>!S(e)&&s.get(e)||Kt,r=>{if(!S(e)){const i=s.get(e);e in vt||(vt[e]=i),t[5](e,ge(i,r),i||Kt)}},t[6],()=>!S(e)&&e in vt?vt[e]:!S(e)&&s.get(e)||Kt]};let ls=!0;const co=()=>ls,[cs,us]=Rt&&window.addEventListener?[window.addEventListener.bind(window),window.removeEventListener.bind(window)]:[xe,xe],uo=()=>{const s=as&&document.visibilityState;return S(s)||s!=="hidden"},ho=s=>(as&&document.addEventListener("visibilitychange",s),cs("focus",s),()=>{as&&document.removeEventListener("visibilitychange",s),us("focus",s)}),fo=s=>{const e=()=>{ls=!0,s()},t=()=>{ls=!1};return cs("online",e),cs("offline",t),()=>{us("online",e),us("offline",t)}},po={isOnline:co,isVisible:uo},go={initFocus:ho,initReconnect:fo},Xs=!v.useId,lt=!Rt||"Deno"in window,mo=s=>lo()?window.requestAnimationFrame(s):setTimeout(s,1),nt=lt?m.useEffect:m.useLayoutEffect,Jt=typeof navigator<"u"&&navigator.connection,Zs=!lt&&Jt&&(["slow-2g","2g"].includes(Jt.effectiveType)||Jt.saveData),je=s=>{if(le(s))try{s=s()}catch{s=""}const e=s;return s=typeof s=="string"?s:(Array.isArray(s)?s.length:s)?at(s):"",[s,e]};let vo=0;const ds=()=>++vo,$r=0,Dr=1,Mr=2,bo=3;var Qe={__proto__:null,ERROR_REVALIDATE_EVENT:bo,FOCUS_EVENT:$r,MUTATE_EVENT:Mr,RECONNECT_EVENT:Dr};async function zr(...s){const[e,t,r,i]=s,n=ge({populateCache:!0,throwOnError:!0},typeof i=="boolean"?{revalidate:i}:i||{});let o=n.populateCache;const a=n.rollbackOnError;let l=n.optimisticData;const d=n.revalidate!==!1,u=p=>typeof a=="function"?a(p):a!==!1,h=n.throwOnError;if(le(t)){const p=t,g=[],_=e.keys();for(const w of _)!/^\$(inf|sub)\$/.test(w)&&p(e.get(w)._k)&&g.push(w);return Promise.all(g.map(f))}return f(t);async function f(p){const[g]=je(p);if(!g)return;const[_,w]=ye(e,g),[b,N,R,T]=ue.get(e),O=b[g],B=()=>d&&(delete R[g],delete T[g],O&&O[0])?O[0](Mr).then(()=>_().data):_().data;if(s.length<3)return B();let x=r,C;const L=ds();N[g]=[L,0];const D=!S(l),V=_(),H=V.data,ee=V._c,E=S(ee)?H:ee;if(D&&(l=le(l)?l(E,H):l,w({data:l,_c:E})),le(x))try{x=x(E)}catch(M){C=M}if(x&&oo(x))if(x=await x.catch(M=>{C=M}),L!==N[g][0]){if(C)throw C;return x}else C&&D&&u(C)&&(o=!0,x=E,w({data:x,_c:K}));o&&(C||(le(o)&&(x=o(x,E)),w({data:x,error:K,_c:K}))),N[g][1]=ds();const A=await B();if(w({_c:K}),C){if(h)throw C;return}return o?A:x}}const er=(s,e)=>{for(const t in s)s[t][0]&&s[t][0](e)},Fr=(s,e)=>{if(!ue.has(s)){const t=ge(go,e),r={},i=zr.bind(K,s);let n=xe;const o={},a=(u,h)=>{const f=o[u]||[];return o[u]=f,f.push(h),()=>f.splice(f.indexOf(h),1)},l=(u,h,f)=>{s.set(u,h);const p=o[u];if(p)for(const g of p)g(h,f)},d=()=>{if(!ue.has(s)&&(ue.set(s,[r,{},{},{},i,l,a]),!lt)){const u=t.initFocus(setTimeout.bind(K,er.bind(K,r,$r))),h=t.initReconnect(setTimeout.bind(K,er.bind(K,r,Dr)));n=()=>{u&&u(),h&&h(),ue.delete(s)}}};return d(),[s,i,d,n]}return[s,ue.get(s)[4]]},_o=(s,e,t,r,i)=>{const n=t.errorRetryCount,o=i.retryCount,a=~~((Math.random()+.5)*(1<<(o<8?o:8)))*t.errorRetryInterval;!S(n)&&o>n||setTimeout(r,a,i)},yo=(s,e)=>at(s)==at(e),[At,Br]=Fr(new Map),Wr=ge({onLoadingSlow:xe,onSuccess:xe,onError:xe,onErrorRetry:_o,onDiscarded:xe,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:Zs?1e4:5e3,focusThrottleInterval:5*1e3,dedupingInterval:2*1e3,loadingTimeout:Zs?5e3:3e3,compare:yo,isPaused:()=>!1,cache:At,mutate:Br,fallback:{}},po),Vr=(s,e)=>{const t=ge(s,e);if(e){const{use:r,fallback:i}=s,{use:n,fallback:o}=e;r&&n&&(t.use=r.concat(n)),i&&o&&(t.fallback=ge(i,o))}return t},hs=m.createContext({}),wo=s=>{const{value:e}=s,t=m.useContext(hs),r=le(e),i=m.useMemo(()=>r?e(t):e,[r,t,e]),n=m.useMemo(()=>r?i:Vr(t,i),[r,t,i]),o=i&&i.provider,a=m.useRef(K);o&&!a.current&&(a.current=Fr(o(n.cache||At),i));const l=a.current;return l&&(n.cache=l[0],n.mutate=l[1]),nt(()=>{if(l)return l[2]&&l[2](),l[3]},[]),m.createElement(hs.Provider,ge(s,{value:n}))},qr=Rt&&window.__SWR_DEVTOOLS_USE__,ko=qr?window.__SWR_DEVTOOLS_USE__:[],xo=()=>{qr&&(window.__SWR_DEVTOOLS_REACT__=v)},Hr=s=>le(s[1])?[s[0],s[1],s[2]||{}]:[s[0],null,(s[1]===null?s[2]:s[1])||{}],Gr=()=>ge(Wr,m.useContext(hs)),jo=(s,e)=>{const[t,r]=je(s),[,,,i]=ue.get(At);if(i[t])return i[t];const n=e(r);return i[t]=n,n},So=s=>(e,t,r)=>s(e,t&&((...n)=>{const[o]=je(e),[,,,a]=ue.get(At),l=a[o];return S(l)?t(...n):(delete a[o],l)}),r),Eo=ko.concat(So),Co=s=>function(...t){const r=Gr(),[i,n,o]=Hr(t),a=Vr(r,o);let l=s;const{use:d}=a,u=(d||[]).concat(Eo);for(let h=u.length;h--;)l=u[h](l);return l(i,n||a.fetcher||null,a)},Po=(s,e,t)=>{const r=e[s]||(e[s]=[]);return r.push(t),()=>{const i=r.indexOf(t);i>=0&&(r[i]=r[r.length-1],r.pop())}},Oo=(s,e)=>(...t)=>{const[r,i,n]=Hr(t),o=(n.use||[]).concat(e);return s(r,i,{...n,use:o})};xo();const To=s=>je(s)[0],tr=v.use||(s=>{if(s.status==="pending")throw s;if(s.status==="fulfilled")return s.value;throw s.status==="rejected"?s.reason:(s.status="pending",s.then(e=>{s.status="fulfilled",s.value=e},e=>{s.status="rejected",s.reason=e}),s)}),Yt={dedupe:!0},No=(s,e,t)=>{const{cache:r,compare:i,suspense:n,fallbackData:o,revalidateOnMount:a,revalidateIfStale:l,refreshInterval:d,refreshWhenHidden:u,refreshWhenOffline:h,keepPreviousData:f}=t,[p,g,_,w]=ue.get(r),[b,N]=je(s),R=m.useRef(!1),T=m.useRef(!1),O=m.useRef(b),B=m.useRef(e),x=m.useRef(t),C=()=>x.current,L=()=>C().isVisible()&&C().isOnline(),[D,V,H,ee]=ye(r,b),E=m.useRef({}).current,A=S(o)?t.fallback[b]:o,M=(U,$)=>{for(const q in E){const z=q;if(z==="data"){if(!i(U[z],$[z])&&(!S(U[z])||!i(pt,$[z])))return!1}else if($[z]!==U[z])return!1}return!0},ne=m.useMemo(()=>{const U=!b||!e?!1:S(a)?C().isPaused()||n?!1:S(l)?!0:l:a,$=G=>{const he=ge(G);return delete he._k,U?{isValidating:!0,isLoading:!0,...he}:he},q=D(),z=ee(),ce=$(q),Ue=q===z?ce:$(z);let W=ce;return[()=>{const G=$(D());return M(G,W)?(W.data=G.data,W.isLoading=G.isLoading,W.isValidating=G.isValidating,W.error=G.error,W):(W=G,G)},()=>Ue]},[r,b]),ie=Ur.useSyncExternalStore(m.useCallback(U=>H(b,($,q)=>{M(q,$)||U()}),[r,b]),ne[0],ne[1]),Se=!R.current,te=p[b]&&p[b].length>0,ve=ie.data,de=S(ve)?A:ve,ft=ie.error,Ds=m.useRef(de),pt=f?S(ve)?Ds.current:ve:de,Ms=te&&!S(ft)?!1:Se&&!S(a)?a:C().isPaused()?!1:n?S(de)?!1:l:S(de)||l,zs=!!(b&&e&&Se&&Ms),Rn=S(ie.isValidating)?zs:ie.isValidating,An=S(ie.isLoading)?zs:ie.isLoading,Je=m.useCallback(async U=>{const $=B.current;if(!b||!$||T.current||C().isPaused())return!1;let q,z,ce=!0;const Ue=U||{},W=!_[b]||!Ue.dedupe,G=()=>Xs?!T.current&&b===O.current&&R.current:b===O.current,he={isValidating:!1,isLoading:!1},Bs=()=>{V(he)},Ws=()=>{const re=_[b];re&&re[1]===z&&delete _[b]},Vs={isValidating:!0};S(D().data)&&(Vs.isLoading=!0);try{if(W&&(V(Vs),t.loadingTimeout&&S(D().data)&&setTimeout(()=>{ce&&G()&&C().onLoadingSlow(b,t)},t.loadingTimeout),_[b]=[$(N),ds()]),[q,z]=_[b],q=await q,W&&setTimeout(Ws,t.dedupingInterval),!_[b]||_[b][1]!==z)return W&&G()&&C().onDiscarded(b),!1;he.error=K;const re=g[b];if(!S(re)&&(z<=re[0]||z<=re[1]||re[1]===0))return Bs(),W&&G()&&C().onDiscarded(b),!1;const fe=D().data;he.data=i(fe,q)?fe:q,W&&G()&&C().onSuccess(q,b,t)}catch(re){Ws();const fe=C(),{shouldRetryOnError:Bt}=fe;fe.isPaused()||(he.error=re,W&&G()&&(fe.onError(re,b,fe),(Bt===!0||le(Bt)&&Bt(re))&&L()&&fe.onErrorRetry(re,b,fe,In=>{const Wt=p[b];Wt&&Wt[0]&&Wt[0](Qe.ERROR_REVALIDATE_EVENT,In)},{retryCount:(Ue.retryCount||0)+1,dedupe:!0})))}return ce=!1,Bs(),!0},[b,r]),Fs=m.useCallback((...U)=>zr(r,O.current,...U),[]);if(nt(()=>{B.current=e,x.current=t,S(ve)||(Ds.current=ve)}),nt(()=>{if(!b)return;const U=Je.bind(K,Yt);let $=0;const z=Po(b,p,(ce,Ue={})=>{if(ce==Qe.FOCUS_EVENT){const W=Date.now();C().revalidateOnFocus&&W>$&&L()&&($=W+C().focusThrottleInterval,U())}else if(ce==Qe.RECONNECT_EVENT)C().revalidateOnReconnect&&L()&&U();else{if(ce==Qe.MUTATE_EVENT)return Je();if(ce==Qe.ERROR_REVALIDATE_EVENT)return Je(Ue)}});return T.current=!1,O.current=b,R.current=!0,V({_k:N}),Ms&&(S(de)||lt?U():mo(U)),()=>{T.current=!0,z()}},[b]),nt(()=>{let U;function $(){const z=le(d)?d(D().data):d;z&&U!==-1&&(U=setTimeout(q,z))}function q(){!D().error&&(u||C().isVisible())&&(h||C().isOnline())?Je(Yt).then($):$()}return $(),()=>{U&&(clearTimeout(U),U=-1)}},[d,u,h,b]),m.useDebugValue(pt),n&&S(de)&&b){if(!Xs&&lt)throw new Error("Fallback data is required when using suspense in SSR.");B.current=e,x.current=t,T.current=!1;const U=w[b];if(!S(U)){const $=Fs(U);tr($)}if(S(ft)){const $=Je(Yt);S(pt)||($.status="fulfilled",$.value=!0),tr($)}else throw ft}return{mutate:Fs,get data(){return E.data=!0,pt},get error(){return E.error=!0,ft},get isValidating(){return E.isValidating=!0,Rn},get isLoading(){return E.isLoading=!0,An}}},Es=xt.defineProperty(wo,"defaultValue",{value:Wr}),Cs=Co(No),Ro=Object.freeze(Object.defineProperty({__proto__:null,SWRConfig:Es,default:Cs,mutate:Br,preload:jo,unstable_serialize:To,useSWRConfig:Gr},Symbol.toStringTag,{value:"Module"})),Ao="$inf$",Io=s=>je(s?s(0,null):null)[0],Qt=Promise.resolve(),Lo=s=>(e,t,r)=>{const i=m.useRef(!1),{cache:n,initialSize:o=1,revalidateAll:a=!1,persistSize:l=!1,revalidateFirstPage:d=!0,revalidateOnMount:u=!1,parallel:h=!1}=r;let f;try{f=Io(e),f&&(f=Ao+f)}catch{}const[p,g,_]=ye(n,f),w=m.useCallback(()=>S(p()._l)?o:p()._l,[n,f,o]);Ur.useSyncExternalStore(m.useCallback(x=>f?_(f,()=>{x()}):()=>{},[n,f]),w,w);const b=m.useCallback(()=>{const x=p()._l;return S(x)?o:x},[f,o]),N=m.useRef(b());nt(()=>{if(!i.current){i.current=!0;return}f&&g({_l:l?N.current:b()})},[f,n]);const R=u&&!i.current,T=s(f,async x=>{const C=p()._i,L=[],D=b(),[V]=ye(n,x),H=V().data,ee=[];let E=null;for(let A=0;A<D;++A){const[M,ne]=je(e(A,h?null:E));if(!M)break;const[ie,Se]=ye(n,M);let te=ie().data;const ve=a||C||S(te)||d&&!A&&!S(H)||R||H&&!S(H[A])&&!r.compare(H[A],te);if(t&&ve){const de=async()=>{te=await t(ne),Se({data:te,_k:ne}),L[A]=te};h?ee.push(de):await de()}else L[A]=te;h||(E=te)}return h&&await Promise.all(ee.map(A=>A())),g({_i:K}),L},r),O=m.useCallback(function(x,C){const L=typeof C=="boolean"?{revalidate:C}:C||{},D=L.revalidate!==!1;return f?(D&&(S(x)?g({_i:!0}):g({_i:!1})),arguments.length?T.mutate(x,{...L,revalidate:D}):T.mutate()):Qt},[f,n]),B=m.useCallback(x=>{if(!f)return Qt;const[,C]=ye(n,f);let L;if(le(x)?L=x(b()):typeof x=="number"&&(L=x),typeof L!="number")return Qt;C({_l:L}),N.current=L;const D=[],[V]=ye(n,f);let H=null;for(let ee=0;ee<L;++ee){const[E]=je(e(ee,H)),[A]=ye(n,E),M=E?A().data:K;if(S(M))return O(V().data);D.push(M),H=M}return O(D)},[f,n,O,b]);return{size:b(),setSize:B,mutate:O,get data(){return T.data},get error(){return T.error},get isValidating(){return T.isValidating},get isLoading(){return T.isLoading}}},Uo=Oo(Cs,Lo);function $o(s,e){if(!s)throw typeof e=="string"?new Error(e):new Error(`${e.displayName} not found`)}var He=(s,e)=>{const{assertCtxFn:t=$o}={},r=v.createContext(void 0);return r.displayName=s,[r,()=>{const o=v.useContext(r);return t(o,`${s} not found`),o.value},()=>{const o=v.useContext(r);return o?o.value:{}}]},Kr={};hi(Kr,{SWRConfig:()=>Es,useSWR:()=>Cs,useSWRInfinite:()=>Uo});pi(Kr,Ro);var[Do,Mo]=He("ClerkInstanceContext"),[zo,Fo]=He("UserContext"),[Bo,iu]=He("ClientContext"),[Wo,ou]=He("SessionContext"),[Vo,au]=He("OrganizationContext"),qo=({children:s,organization:e,lastOrganizationMember:t,lastOrganizationInvitation:r,swrConfig:i})=>v.createElement(Es,{value:i},v.createElement(Vo.Provider,{value:{value:{organization:e,lastOrganizationMember:t,lastOrganizationInvitation:r}}},s));typeof window<"u"?v.useLayoutEffect:v.useEffect;const[Ho,Jr]=[Do,Mo];function Go(s){if(!s)throw new Error(wi)}const Yr=Object.freeze({noGuarantees:Object.freeze({guaranteedLoaded:!1}),guaranteedLoaded:Object.freeze({guaranteedLoaded:!0})}),It=v.createContext(void 0);It.displayName="StructureContext";const Ko=()=>{const s=v.useContext(It);return Go(s),s},Jo=({children:s})=>Ko().guaranteedLoaded?v.createElement(v.Fragment,null,s):v.createElement(It.Provider,{value:Yr.guaranteedLoaded},s),J=(s,e)=>{e=e||s.displayName||s.name||"Component",s.displayName=e;const t=r=>{const i=Jr();return i.loaded?v.createElement(Jo,null,v.createElement(s,{...r,clerk:i})):null};return t.displayName=`withClerk(${e})`,t},Xe=s=>"mount"in s,sr=s=>"open"in s;class me extends v.PureComponent{constructor(){super(...arguments),this.portalRef=v.createRef()}componentDidUpdate(e){var t,r,i,n;!Xe(e)||!Xe(this.props)||(e.props.appearance!==this.props.props.appearance||((r=(t=e.props)==null?void 0:t.customPages)==null?void 0:r.length)!==((n=(i=this.props.props)==null?void 0:i.customPages)==null?void 0:n.length))&&this.props.updateProps({node:this.portalRef.current,props:this.props.props})}componentDidMount(){this.portalRef.current&&(Xe(this.props)&&this.props.mount(this.portalRef.current,this.props.props),sr(this.props)&&this.props.open(this.props.props))}componentWillUnmount(){this.portalRef.current&&(Xe(this.props)&&this.props.unmount(this.portalRef.current),sr(this.props)&&this.props.close())}render(){var e,t;return v.createElement(v.Fragment,null,v.createElement("div",{ref:this.portalRef}),Xe(this.props)&&((t=(e=this.props)==null?void 0:e.customPagesPortals)==null?void 0:t.map((r,i)=>m.createElement(r,{key:i}))))}}const Yo=J(({clerk:s,...e})=>v.createElement(me,{mount:s.mountSignIn,unmount:s.unmountSignIn,updateProps:s.__unstable__updateProps,props:e}),"SignIn"),Qo=J(({clerk:s,...e})=>v.createElement(me,{mount:s.mountSignUp,unmount:s.unmountSignUp,updateProps:s.__unstable__updateProps,props:e}),"SignUp");function Ps({children:s}){return Ae(ji),v.createElement(v.Fragment,null,s)}function Os({children:s}){return Ae(Si),v.createElement(v.Fragment,null,s)}const Xo=J(({clerk:s,...e})=>{const{customPages:t,customPagesPortals:r}=Qr(e.children);return v.createElement(me,{mount:s.mountUserProfile,unmount:s.unmountUserProfile,updateProps:s.__unstable__updateProps,props:{...e,customPages:t},customPagesPortals:r})},"UserProfile");Object.assign(Xo,{Page:Ps,Link:Os});const Zo=J(({clerk:s,...e})=>{const{customPages:t,customPagesPortals:r}=Qr(e.children),i=Object.assign(e.userProfileProps||{},{customPages:t});return v.createElement(me,{mount:s.mountUserButton,unmount:s.unmountUserButton,updateProps:s.__unstable__updateProps,props:{...e,userProfileProps:i},customPagesPortals:r})},"UserButton"),ea=Object.assign(Zo,{UserProfilePage:Ps,UserProfileLink:Os});function Ts({children:s}){return Ae(Ei),v.createElement(v.Fragment,null,s)}function Ns({children:s}){return Ae(Ci),v.createElement(v.Fragment,null,s)}const ta=J(({clerk:s,...e})=>{const{customPages:t,customPagesPortals:r}=Xr(e.children);return v.createElement(me,{mount:s.mountOrganizationProfile,unmount:s.unmountOrganizationProfile,updateProps:s.__unstable__updateProps,props:{...e,customPages:t},customPagesPortals:r})},"OrganizationProfile");Object.assign(ta,{Page:Ts,Link:Ns});J(({clerk:s,...e})=>v.createElement(me,{mount:s.mountCreateOrganization,unmount:s.unmountCreateOrganization,updateProps:s.__unstable__updateProps,props:e}),"CreateOrganization");const sa=J(({clerk:s,...e})=>{const{customPages:t,customPagesPortals:r}=Xr(e.children),i=Object.assign(e.organizationProfileProps||{},{customPages:t});return v.createElement(me,{mount:s.mountOrganizationSwitcher,unmount:s.unmountOrganizationSwitcher,updateProps:s.__unstable__updateProps,props:{...e,organizationProfileProps:i},customPagesPortals:r})},"OrganizationSwitcher");Object.assign(sa,{OrganizationProfilePage:Ts,OrganizationProfileLink:Ns});J(({clerk:s,...e})=>v.createElement(me,{mount:s.mountOrganizationList,unmount:s.unmountOrganizationList,updateProps:s.__unstable__updateProps,props:e}),"OrganizationList");J(({clerk:s,...e})=>v.createElement(me,{open:s.openGoogleOneTap,close:s.closeGoogleOneTap,props:e}),"GoogleOneTap");const bt=(s,e)=>!!s&&v.isValidElement(s)&&(s==null?void 0:s.type)===e,Qr=s=>Zr({children:s,reorderItemsLabels:["account","security"],LinkComponent:Os,PageComponent:Ps,componentName:"UserProfile"}),Xr=s=>Zr({children:s,reorderItemsLabels:["members","settings"],LinkComponent:Ns,PageComponent:Ts,componentName:"OrganizationProfile"}),Zr=({children:s,LinkComponent:e,PageComponent:t,reorderItemsLabels:r,componentName:i})=>{const n=[];v.Children.forEach(s,g=>{if(!bt(g,t)&&!bt(g,e)){g&&Ae(Pi(i));return}const{props:_}=g,{children:w,label:b,url:N,labelIcon:R}=_;if(bt(g,t))if(rr(_,r))n.push({label:b});else if(Xt(_))n.push({label:b,labelIcon:R,children:w,url:N});else{Ae(Oi(i));return}if(bt(g,e))if(Zt(_))n.push({label:b,labelIcon:R,url:N});else{Ae(Ti(i));return}});const o=[],a=[],l=[];n.forEach((g,_)=>{if(Xt(g)){o.push({component:g.children,id:_}),a.push({component:g.labelIcon,id:_});return}Zt(g)&&l.push({component:g.labelIcon,id:_})});const d=qt(o),u=qt(a),h=qt(l),f=[],p=[];return n.forEach((g,_)=>{if(rr(g,r)){f.push({label:g.label});return}if(Xt(g)){const{portal:w,mount:b,unmount:N}=d.find(B=>B.id===_),{portal:R,mount:T,unmount:O}=u.find(B=>B.id===_);f.push({label:g.label,url:g.url,mount:b,unmount:N,mountIcon:T,unmountIcon:O}),p.push(w),p.push(R);return}if(Zt(g)){const{portal:w,mount:b,unmount:N}=h.find(R=>R.id===_);f.push({label:g.label,url:g.url,mountIcon:b,unmountIcon:N}),p.push(w);return}}),{customPages:f,customPagesPortals:p}},rr=(s,e)=>{const{children:t,label:r,url:i,labelIcon:n}=s;return!t&&!i&&!n&&e.some(o=>o===r)},Xt=s=>{const{children:e,label:t,url:r,labelIcon:i}=s;return!!e&&!!r&&!!i&&!!t},Zt=s=>{const{children:e,label:t,url:r,labelIcon:i}=s;return!e&&!!r&&!!i&&!!t};var k,ze,Fe,jt,St,Ne,fs,en;const tn=class sn{constructor(e){Pe(this,fs),this.clerkjs=null,this.preopenOneTap=null,this.preopenSignIn=null,this.preopenSignUp=null,this.preopenUserProfile=null,this.preopenOrganizationProfile=null,this.preopenCreateOrganization=null,this.premountSignInNodes=new Map,this.premountSignUpNodes=new Map,this.premountUserProfileNodes=new Map,this.premountUserButtonNodes=new Map,this.premountOrganizationProfileNodes=new Map,this.premountCreateOrganizationNodes=new Map,this.premountOrganizationSwitcherNodes=new Map,this.premountOrganizationListNodes=new Map,this.premountMethodCalls=new Map,this.loadedListeners=[],Pe(this,k,!1),Pe(this,ze,void 0),Pe(this,Fe,void 0),Pe(this,jt,void 0),Pe(this,St,void 0),this.isReady=()=>{var n;return!!((n=this.clerkjs)!=null&&n.isReady())},this.buildSignInUrl=n=>{const o=()=>{var a;return((a=this.clerkjs)==null?void 0:a.buildSignInUrl(n))||""};if(this.clerkjs&&y(this,k))return o();this.premountMethodCalls.set("buildSignInUrl",o)},this.buildSignUpUrl=n=>{const o=()=>{var a;return((a=this.clerkjs)==null?void 0:a.buildSignUpUrl(n))||""};if(this.clerkjs&&y(this,k))return o();this.premountMethodCalls.set("buildSignUpUrl",o)},this.buildUserProfileUrl=()=>{const n=()=>{var o;return((o=this.clerkjs)==null?void 0:o.buildUserProfileUrl())||""};if(this.clerkjs&&y(this,k))return n();this.premountMethodCalls.set("buildUserProfileUrl",n)},this.buildCreateOrganizationUrl=()=>{const n=()=>{var o;return((o=this.clerkjs)==null?void 0:o.buildCreateOrganizationUrl())||""};if(this.clerkjs&&y(this,k))return n();this.premountMethodCalls.set("buildCreateOrganizationUrl",n)},this.buildOrganizationProfileUrl=()=>{const n=()=>{var o;return((o=this.clerkjs)==null?void 0:o.buildOrganizationProfileUrl())||""};if(this.clerkjs&&y(this,k))return n();this.premountMethodCalls.set("buildOrganizationProfileUrl",n)},this.buildHomeUrl=()=>{const n=()=>{var o;return((o=this.clerkjs)==null?void 0:o.buildHomeUrl())||""};if(this.clerkjs&&y(this,k))return n();this.premountMethodCalls.set("buildHomeUrl",n)},this.buildUrlWithAuth=n=>{const o=()=>{var a;return((a=this.clerkjs)==null?void 0:a.buildUrlWithAuth(n))||""};if(this.clerkjs&&y(this,k))return o();this.premountMethodCalls.set("buildUrlWithAuth",o)},this.handleUnauthenticated=()=>{const n=()=>{var o;return(o=this.clerkjs)==null?void 0:o.handleUnauthenticated()};this.clerkjs&&y(this,k)?n():this.premountMethodCalls.set("handleUnauthenticated",n)},this.addOnLoaded=n=>{this.loadedListeners.push(n),this.loaded&&this.emitLoaded()},this.emitLoaded=()=>{this.loadedListeners.forEach(n=>n()),this.loadedListeners=[]},this.hydrateClerkJS=n=>{if(!n)throw new Error("Failed to hydrate latest Clerk JS");return this.clerkjs=n,this.premountMethodCalls.forEach(o=>o()),this.preopenSignIn!==null&&n.openSignIn(this.preopenSignIn),this.preopenSignUp!==null&&n.openSignUp(this.preopenSignUp),this.preopenUserProfile!==null&&n.openUserProfile(this.preopenUserProfile),this.preopenOneTap!==null&&n.openGoogleOneTap(this.preopenOneTap),this.preopenOrganizationProfile!==null&&n.openOrganizationProfile(this.preopenOrganizationProfile),this.preopenCreateOrganization!==null&&n.openCreateOrganization(this.preopenCreateOrganization),this.premountSignInNodes.forEach((o,a)=>{n.mountSignIn(a,o)}),this.premountSignUpNodes.forEach((o,a)=>{n.mountSignUp(a,o)}),this.premountUserProfileNodes.forEach((o,a)=>{n.mountUserProfile(a,o)}),this.premountUserButtonNodes.forEach((o,a)=>{n.mountUserButton(a,o)}),this.premountOrganizationListNodes.forEach((o,a)=>{n.mountOrganizationList(a,o)}),Ee(this,k,!0),this.emitLoaded(),this.clerkjs},this.__unstable__updateProps=n=>{if(this.clerkjs&&"__unstable__updateProps"in this.clerkjs)this.clerkjs.__unstable__updateProps(n);else return},this.setActive=({session:n,organization:o,beforeEmit:a})=>this.clerkjs?this.clerkjs.setActive({session:n,organization:o,beforeEmit:a}):Promise.reject(),this.setSession=(n,o)=>(Et("setSession","Use `Clerk.setActive` instead"),this.setActive({session:n,beforeEmit:o})),this.openSignIn=n=>{this.clerkjs&&y(this,k)?this.clerkjs.openSignIn(n):this.preopenSignIn=n},this.closeSignIn=()=>{this.clerkjs&&y(this,k)?this.clerkjs.closeSignIn():this.preopenSignIn=null},this.openGoogleOneTap=n=>{this.clerkjs&&y(this,k)?this.clerkjs.openGoogleOneTap(n):this.preopenOneTap=n},this.closeGoogleOneTap=()=>{this.clerkjs&&y(this,k)?this.clerkjs.closeGoogleOneTap():this.preopenOneTap=null},this.openUserProfile=n=>{this.clerkjs&&y(this,k)?this.clerkjs.openUserProfile(n):this.preopenUserProfile=n},this.closeUserProfile=()=>{this.clerkjs&&y(this,k)?this.clerkjs.closeUserProfile():this.preopenUserProfile=null},this.openOrganizationProfile=n=>{this.clerkjs&&y(this,k)?this.clerkjs.openOrganizationProfile(n):this.preopenOrganizationProfile=n},this.closeOrganizationProfile=()=>{this.clerkjs&&y(this,k)?this.clerkjs.closeOrganizationProfile():this.preopenOrganizationProfile=null},this.openCreateOrganization=n=>{this.clerkjs&&y(this,k)?this.clerkjs.openCreateOrganization(n):this.preopenCreateOrganization=n},this.closeCreateOrganization=()=>{this.clerkjs&&y(this,k)?this.clerkjs.closeCreateOrganization():this.preopenCreateOrganization=null},this.openSignUp=n=>{this.clerkjs&&y(this,k)?this.clerkjs.openSignUp(n):this.preopenSignUp=n},this.closeSignUp=()=>{this.clerkjs&&y(this,k)?this.clerkjs.closeSignUp():this.preopenSignUp=null},this.mountSignIn=(n,o)=>{this.clerkjs&&y(this,k)?this.clerkjs.mountSignIn(n,o):this.premountSignInNodes.set(n,o)},this.unmountSignIn=n=>{this.clerkjs&&y(this,k)?this.clerkjs.unmountSignIn(n):this.premountSignInNodes.delete(n)},this.mountSignUp=(n,o)=>{this.clerkjs&&y(this,k)?this.clerkjs.mountSignUp(n,o):this.premountSignUpNodes.set(n,o)},this.unmountSignUp=n=>{this.clerkjs&&y(this,k)?this.clerkjs.unmountSignUp(n):this.premountSignUpNodes.delete(n)},this.mountUserProfile=(n,o)=>{this.clerkjs&&y(this,k)?this.clerkjs.mountUserProfile(n,o):this.premountUserProfileNodes.set(n,o)},this.unmountUserProfile=n=>{this.clerkjs&&y(this,k)?this.clerkjs.unmountUserProfile(n):this.premountUserProfileNodes.delete(n)},this.mountOrganizationProfile=(n,o)=>{this.clerkjs&&y(this,k)?this.clerkjs.mountOrganizationProfile(n,o):this.premountOrganizationProfileNodes.set(n,o)},this.unmountOrganizationProfile=n=>{this.clerkjs&&y(this,k)?this.clerkjs.unmountOrganizationProfile(n):this.premountOrganizationProfileNodes.delete(n)},this.mountCreateOrganization=(n,o)=>{this.clerkjs&&y(this,k)?this.clerkjs.mountCreateOrganization(n,o):this.premountCreateOrganizationNodes.set(n,o)},this.unmountCreateOrganization=n=>{this.clerkjs&&y(this,k)?this.clerkjs.unmountCreateOrganization(n):this.premountCreateOrganizationNodes.delete(n)},this.mountOrganizationSwitcher=(n,o)=>{this.clerkjs&&y(this,k)?this.clerkjs.mountOrganizationSwitcher(n,o):this.premountOrganizationSwitcherNodes.set(n,o)},this.unmountOrganizationSwitcher=n=>{this.clerkjs&&y(this,k)?this.clerkjs.unmountOrganizationSwitcher(n):this.premountOrganizationSwitcherNodes.delete(n)},this.mountOrganizationList=(n,o)=>{this.clerkjs&&y(this,k)?this.clerkjs.mountOrganizationList(n,o):this.premountOrganizationListNodes.set(n,o)},this.unmountOrganizationList=n=>{this.clerkjs&&y(this,k)?this.clerkjs.unmountOrganizationList(n):this.premountOrganizationListNodes.delete(n)},this.mountUserButton=(n,o)=>{this.clerkjs&&y(this,k)?this.clerkjs.mountUserButton(n,o):this.premountUserButtonNodes.set(n,o)},this.unmountUserButton=n=>{this.clerkjs&&y(this,k)?this.clerkjs.unmountUserButton(n):this.premountUserButtonNodes.delete(n)},this.addListener=n=>{const o=()=>{var a;return(a=this.clerkjs)==null?void 0:a.addListener(n)};return this.clerkjs?o():(this.premountMethodCalls.set("addListener",o),()=>this.premountMethodCalls.delete("addListener"))},this.navigate=n=>{const o=()=>{var a;return(a=this.clerkjs)==null?void 0:a.navigate(n)};this.clerkjs&&y(this,k)?o():this.premountMethodCalls.set("navigate",o)},this.redirectWithAuth=(...n)=>{const o=()=>{var a;return(a=this.clerkjs)==null?void 0:a.redirectWithAuth(...n)};this.clerkjs&&y(this,k)?o():this.premountMethodCalls.set("redirectWithAuth",o)},this.redirectToSignIn=n=>{const o=()=>{var a;return(a=this.clerkjs)==null?void 0:a.redirectToSignIn(n)};this.clerkjs&&y(this,k)?o():this.premountMethodCalls.set("redirectToSignIn",o)},this.redirectToSignUp=n=>{const o=()=>{var a;return(a=this.clerkjs)==null?void 0:a.redirectToSignUp(n)};this.clerkjs&&y(this,k)?o():this.premountMethodCalls.set("redirectToSignUp",o)},this.redirectToUserProfile=()=>{const n=()=>{var o;return(o=this.clerkjs)==null?void 0:o.redirectToUserProfile()};this.clerkjs&&y(this,k)?n():this.premountMethodCalls.set("redirectToUserProfile",n)},this.redirectToHome=()=>{const n=()=>{var o;return(o=this.clerkjs)==null?void 0:o.redirectToHome()};this.clerkjs&&y(this,k)?n():this.premountMethodCalls.set("redirectToHome",n)},this.redirectToOrganizationProfile=()=>{const n=()=>{var o;return(o=this.clerkjs)==null?void 0:o.redirectToOrganizationProfile()};this.clerkjs&&y(this,k)?n():this.premountMethodCalls.set("redirectToOrganizationProfile",n)},this.redirectToCreateOrganization=()=>{const n=()=>{var o;return(o=this.clerkjs)==null?void 0:o.redirectToCreateOrganization()};this.clerkjs&&y(this,k)?n():this.premountMethodCalls.set("redirectToCreateOrganization",n)},this.handleRedirectCallback=n=>{var o;const a=()=>{var l;return(l=this.clerkjs)==null?void 0:l.handleRedirectCallback(n)};this.clerkjs&&y(this,k)?(o=a())==null||o.catch(()=>{}):this.premountMethodCalls.set("handleRedirectCallback",a)},this.handleMagicLinkVerification=async n=>{Et("handleMagicLinkVerification","Use `handleEmailLinkVerification` instead.");const o=()=>{var a;return(a=this.clerkjs)==null?void 0:a.handleMagicLinkVerification(n)};if(this.clerkjs&&y(this,k))return o();this.premountMethodCalls.set("handleMagicLinkVerification",o)},this.handleGoogleOneTapCallback=(n,o)=>{var a;const l=()=>{var d;return(d=this.clerkjs)==null?void 0:d.handleGoogleOneTapCallback(n,o)};this.clerkjs&&y(this,k)?(a=l())==null||a.catch(()=>{}):this.premountMethodCalls.set("handleGoogleOneTapCallback",l)},this.handleEmailLinkVerification=async n=>{const o=()=>{var a;return(a=this.clerkjs)==null?void 0:a.handleEmailLinkVerification(n)};if(this.clerkjs&&y(this,k))return o();this.premountMethodCalls.set("handleEmailLinkVerification",o)},this.authenticateWithMetamask=async n=>{const o=()=>{var a;return(a=this.clerkjs)==null?void 0:a.authenticateWithMetamask(n)};if(this.clerkjs&&y(this,k))return o();this.premountMethodCalls.set("authenticateWithMetamask",o)},this.authenticateWithGoogleOneTap=async n=>(await ii(this,fs,en).call(this)).authenticateWithGoogleOneTap(n),this.createOrganization=async n=>{const o=()=>{var a;return(a=this.clerkjs)==null?void 0:a.createOrganization(n)};if(this.clerkjs&&y(this,k))return o();this.premountMethodCalls.set("createOrganization",o)},this.getOrganizationMemberships=async()=>{const n=()=>{var o;return(o=this.clerkjs)==null?void 0:o.getOrganizationMemberships()};if(this.clerkjs&&y(this,k))return n();this.premountMethodCalls.set("getOrganizationMemberships",n)},this.getOrganization=async n=>{const o=()=>{var a;return(a=this.clerkjs)==null?void 0:a.getOrganization(n)};if(this.clerkjs&&y(this,k))return o();this.premountMethodCalls.set("getOrganization",o)},this.signOut=async(n,o)=>{const a=()=>{var l;return(l=this.clerkjs)==null?void 0:l.signOut(n,o)};if(this.clerkjs&&y(this,k))return a();this.premountMethodCalls.set("signOut",a)};const{Clerk:t=null,frontendApi:r,publishableKey:i}=e||{};Ee(this,jt,r),Ee(this,St,i),Ee(this,Fe,e==null?void 0:e.proxyUrl),Ee(this,ze,e==null?void 0:e.domain),this.options=e,this.Clerk=t,this.mode=Qs()?"browser":"server",this.loadClerkJS()}get publishableKey(){return y(this,St)}get loaded(){return y(this,k)}static getOrCreateInstance(e){return(!Qs()||!y(this,Ne)||e.Clerk&&y(this,Ne).Clerk!==e.Clerk)&&Ee(this,Ne,new sn(e)),y(this,Ne)}static clearInstance(){Ee(this,Ne,null)}get domain(){if(typeof window<"u"&&window.location)return Ht(y(this,ze),new URL(window.location.href),"");if(typeof y(this,ze)=="function")throw new Error(Vt);return y(this,ze)||""}get proxyUrl(){if(typeof window<"u"&&window.location)return Ht(y(this,Fe),new URL(window.location.href),"");if(typeof y(this,Fe)=="function")throw new Error(Vt);return y(this,Fe)||""}get sdkMetadata(){var e;return((e=this.clerkjs)==null?void 0:e.sdkMetadata)||this.options.sdkMetadata||void 0}get instanceType(){var e;return(e=this.clerkjs)==null?void 0:e.instanceType}get frontendApi(){var e;return((e=this.clerkjs)==null?void 0:e.frontendApi)||y(this,jt)||""}get isStandardBrowser(){var e;return((e=this.clerkjs)==null?void 0:e.isStandardBrowser)||this.options.standardBrowser||!1}get isSatellite(){if(typeof window<"u"&&window.location)return Ht(this.options.isSatellite,new URL(window.location.href),!1);if(typeof this.options.isSatellite=="function")throw new Error(Vt);return!1}async loadClerkJS(){var e,t,r;if(!(this.mode!=="browser"||y(this,k))){typeof window<"u"&&(window.__clerk_frontend_api=this.frontendApi,window.__clerk_publishable_key=this.publishableKey,window.__clerk_proxy_url=this.proxyUrl,window.__clerk_domain=this.domain);try{if(this.Clerk){let i;Ai(this.Clerk)?(i=new this.Clerk(this.publishableKey||this.frontendApi||"",{proxyUrl:this.proxyUrl,domain:this.domain}),await i.load(this.options)):(i=this.Clerk,i.isReady()||await i.load(this.options)),global.Clerk=i}else{if(global.Clerk||await Hi({...this.options,frontendApi:this.frontendApi,publishableKey:this.publishableKey,proxyUrl:this.proxyUrl,domain:this.domain}),!global.Clerk)throw new Error("Failed to download latest ClerkJS. Contact support@clerk.com.");await global.Clerk.load(this.options)}return global.Clerk.sdkMetadata=(e=this.options.sdkMetadata)!=null?e:{name:"@clerk/clerk-react",version:"4.32.4"},(t=global.Clerk)!=null&&t.loaded||(r=global.Clerk)!=null&&r.isReady()?this.hydrateClerkJS(global.Clerk):void 0}catch(i){const n=i;console.error(n.stack||n.message||n);return}}}get version(){var e;return(e=this.clerkjs)==null?void 0:e.version}get client(){if(this.clerkjs)return this.clerkjs.client}get session(){if(this.clerkjs)return this.clerkjs.session}get user(){if(this.clerkjs)return this.clerkjs.user}get organization(){if(this.clerkjs)return this.clerkjs.organization}get __unstable__environment(){if(this.clerkjs)return this.clerkjs.__unstable__environment}__unstable__setEnvironment(...e){if(this.clerkjs&&"__unstable__setEnvironment"in this.clerkjs)this.clerkjs.__unstable__setEnvironment(e);else return}};k=new WeakMap;ze=new WeakMap;Fe=new WeakMap;jt=new WeakMap;St=new WeakMap;Ne=new WeakMap;fs=new WeakSet;en=function(){return new Promise(s=>{y(this,k)&&s(this.clerkjs),this.addOnLoaded(()=>s(this.clerkjs))})};Pe(tn,Ne,void 0);let nr=tn;const ra=(s,e,t)=>!s&&t?na(t):ia(e),na=s=>{const e=s.userId,t=s.user,r=s.sessionId,i=s.session,n=s.organization,o=s.orgId,a=s.orgRole,l=s.orgPermissions,d=s.orgSlug,u=s.actor;return{userId:e,user:t,sessionId:r,session:i,organization:n,orgId:o,orgRole:a,orgPermissions:l,orgSlug:d,actor:u,lastOrganizationInvitation:null,lastOrganizationMember:null}},ia=s=>{var e;const t=s.user?s.user.id:s.user,r=s.user,i=s.session?s.session.id:s.session,n=s.session,o=n==null?void 0:n.actor,a=s.organization,l=s.organization?s.organization.id:s.organization,d=a==null?void 0:a.slug,u=a&&((e=r==null?void 0:r.organizationMemberships)==null?void 0:e.find(_=>_.organization.id===l)),h=u&&u.permissions,f=u&&u.role,p=s.lastOrganizationInvitation,g=s.lastOrganizationMember;return{userId:t,user:r,sessionId:i,session:n,organization:a,orgId:l,orgRole:f,orgSlug:d,orgPermissions:h,actor:o,lastOrganizationInvitation:p,lastOrganizationMember:g}},[oa,Rs]=He("AuthContext");function aa(s){const{isomorphicClerkOptions:e,initialState:t,children:r}=s,{isomorphicClerk:i,loaded:n}=la(e);e.frontendApi&&Et("frontendApi","Use `publishableKey` instead.");const[o,a]=v.useState({client:i.client,session:i.session,user:i.user,organization:i.organization,lastOrganizationInvitation:null,lastOrganizationMember:null});v.useEffect(()=>i.addListener(V=>a({...V})),[]);const l=ra(n,o,t),d=v.useMemo(()=>({value:i}),[n]),u=v.useMemo(()=>({value:o.client}),[o.client]),{sessionId:h,session:f,userId:p,user:g,orgId:_,actor:w,lastOrganizationInvitation:b,lastOrganizationMember:N,organization:R,orgRole:T,orgSlug:O,orgPermissions:B}=l,x=v.useMemo(()=>({value:{sessionId:h,userId:p,actor:w,orgId:_,orgRole:T,orgSlug:O,orgPermissions:B}}),[h,p,w,_,T,O]),C=v.useMemo(()=>({value:g}),[p,g]),L=v.useMemo(()=>({value:f}),[h,f]),D=v.useMemo(()=>({value:{organization:R,lastOrganizationInvitation:b,lastOrganizationMember:N}}),[_,R,b,N]);return v.createElement(Ho.Provider,{value:d},v.createElement(Bo.Provider,{value:u},v.createElement(Wo.Provider,{value:L},v.createElement(qo,{...D.value},v.createElement(oa.Provider,{value:x},v.createElement(zo.Provider,{value:C},r))))))}const la=s=>{const[e,t]=v.useState(!1),r=v.useMemo(()=>nr.getOrCreateInstance(s),[]);return v.useEffect(()=>{r.__unstable__updateProps({appearance:s.appearance})},[s.appearance]),v.useEffect(()=>{r.__unstable__updateProps({options:s})},[s.localization]),v.useEffect(()=>{r.addOnLoaded(()=>t(!0))},[]),v.useEffect(()=>()=>{nr.clearInstance()},[]),{isomorphicClerk:r,loaded:e}};Ri({packageName:"@clerk/clerk-react"});function ca(s){const{initialState:e,children:t,...r}=s,{frontendApi:i="",publishableKey:n="",Clerk:o}=r;return o||(!n&&!i?rt.throwMissingPublishableKeyError():n&&!Nr(n)?rt.throwInvalidPublishableKeyError({key:n}):!n&&i&&!ai(i)&&rt.throwInvalidFrontendApiError({key:i})),v.createElement(It.Provider,{value:Yr.noGuarantees},v.createElement(aa,{initialState:e,isomorphicClerkOptions:r},t))}const rn=Yi(ca,"ClerkProvider",ki);rn.displayName="ClerkProvider";function nn(){const s=Fo();return s===void 0?{isLoaded:!1,isSignedIn:void 0,user:void 0}:s===null?{isLoaded:!0,isSignedIn:!1,user:null}:{isLoaded:!0,isSignedIn:!0,user:s}}const on=s=>new Promise(e=>{s.loaded&&e(),s.addOnLoaded(e)}),ua=s=>async e=>(await on(s),s.session?s.session.getToken(e):null),da=s=>async(...e)=>(await on(s),s.signOut(...e)),an=()=>{const{sessionId:s,userId:e,actor:t,orgId:r,orgRole:i,orgSlug:n,orgPermissions:o}=Rs(),a=Jr(),l=m.useCallback(ua(a),[a]),d=m.useCallback(da(a),[a]),u=m.useCallback(h=>{if(!(h!=null&&h.permission)&&!(h!=null&&h.role))throw new Error(Ni);return!r||!e||!i||!o?!1:h.permission?o.includes(h.permission):h.role?i===h.role:!1},[r,i,e,o]);if(s===void 0&&e===void 0)return{isLoaded:!1,isSignedIn:void 0,sessionId:s,userId:e,actor:void 0,orgId:void 0,orgRole:void 0,orgSlug:void 0,has:void 0,signOut:d,getToken:l};if(s===null&&e===null)return{isLoaded:!0,isSignedIn:!1,sessionId:s,userId:e,actor:null,orgId:null,orgRole:null,orgSlug:null,has:()=>!1,signOut:d,getToken:l};if(s&&e&&r&&i)return{isLoaded:!0,isSignedIn:!0,sessionId:s,userId:e,actor:t||null,orgId:r,orgRole:i,orgSlug:n||null,has:u,signOut:d,getToken:l};if(s&&e&&!r)return{isLoaded:!0,isSignedIn:!0,sessionId:s,userId:e,actor:t||null,orgId:null,orgRole:null,orgSlug:null,has:()=>!1,signOut:d,getToken:l};throw new Error(xi)},ha=({children:s})=>{const{userId:e}=Rs();return e?v.createElement(v.Fragment,null,s):null},fa=({children:s})=>{const{userId:e}=Rs();return e===null?v.createElement(v.Fragment,null,s):null};J(({clerk:s,...e})=>{const{client:t,session:r}=s,{__unstable__environment:i}=s,n=t.activeSessions&&t.activeSessions.length>0;return v.useEffect(()=>{if(r===null&&n&&i){const{afterSignOutOneUrl:o}=i.displayConfig;s.navigate(o)}else s.redirectToSignIn(e)},[]),null},"RedirectToSignIn");J(({clerk:s,...e})=>(v.useEffect(()=>{s.redirectToSignUp(e)},[]),null),"RedirectToSignUp");J(({clerk:s})=>(v.useEffect(()=>{s.redirectToUserProfile()},[]),null),"RedirectToUserProfile");J(({clerk:s})=>(v.useEffect(()=>{s.redirectToOrganizationProfile()},[]),null),"RedirectToOrganizationProfile");J(({clerk:s})=>(v.useEffect(()=>{s.redirectToCreateOrganization()},[]),null),"RedirectToCreateOrganization");J(({clerk:s,...e})=>(v.useEffect(()=>{s.handleRedirectCallback(e)},[]),null),"AuthenticateWithRedirectCallback");const pa=m.createContext({theme:"light",setTheme:()=>null});function ga({children:s}){const[e,t]=m.useState("light");return m.useEffect(()=>{const r=localStorage.getItem("theme")||"light";t(r),document.documentElement.setAttribute("data-theme",r)},[]),c.jsx(pa.Provider,{value:{theme:e,setTheme:t},children:s})}function ma(){const[s,e]=m.useState("light");m.useEffect(()=>{const r=localStorage.getItem("theme")||"light";e(r),document.documentElement.setAttribute("data-theme",r)},[]);const t=()=>{const r=s==="light"?"dark":"light";e(r),localStorage.setItem("theme",r),document.documentElement.setAttribute("data-theme",r)};return c.jsx("button",{onClick:t,className:"btn btn-ghost btn-circle","aria-label":"Toggle theme",children:s==="light"?c.jsx(Fn,{className:"h-5 w-5"}):c.jsx(Bn,{className:"h-5 w-5"})})}function va(){return c.jsx("header",{className:"navbar bg-base-100 border-b",children:c.jsxs("div",{className:"container mx-auto px-4",children:[c.jsx("div",{className:"flex-1",children:c.jsxs(pe,{to:"/",className:"btn btn-ghost gap-2 normal-case text-xl",children:[c.jsx(Wn,{className:"h-6 w-6"}),c.jsx("span",{className:"font-bold",children:"LocksmithFinder"})]})}),c.jsx("div",{className:"flex-none",children:c.jsxs("ul",{className:"menu menu-horizontal px-1 items-center",children:[c.jsx("li",{children:c.jsx(pe,{to:"#features",children:"Features"})}),c.jsx("li",{children:c.jsx(pe,{to:"#how-it-works",children:"How It Works"})}),c.jsx("li",{children:c.jsx(pe,{to:"#contact",children:"Contact"})}),c.jsx(fa,{children:c.jsx("li",{children:c.jsx(pe,{to:"/sign-in",className:"btn btn-primary btn-sm",children:"Locksmith Login"})})}),c.jsxs(ha,{children:[c.jsx("li",{children:c.jsx(pe,{to:"/locksmith/dashboard",className:"btn btn-ghost btn-sm",children:"Dashboard"})}),c.jsx("li",{children:c.jsx(ea,{afterSignOutUrl:"/"})})]}),c.jsx("li",{children:c.jsx(ma,{})})]})})]})})}function ba(){return c.jsxs("footer",{className:"footer footer-center p-10 bg-base-200 text-base-content rounded",children:[c.jsxs("nav",{className:"grid grid-flow-col gap-4",children:[c.jsx(pe,{className:"link link-hover",to:"#",children:"Terms of Service"}),c.jsx(pe,{className:"link link-hover",to:"#",children:"Privacy Policy"})]}),c.jsx("aside",{children:c.jsx("p",{children:" 2024 LocksmithFinder. All rights reserved."})})]})}function _a({postcode:s,onPostcodeChange:e,onSubmit:t}){return c.jsx("section",{className:"hero min-h-[70vh] bg-neutral text-neutral-content",children:c.jsx("div",{className:"hero-content text-center",children:c.jsxs("div",{className:"max-w-2xl",children:[c.jsx("h1",{className:"text-5xl font-bold mb-8",children:"Find Trusted Locksmiths in Your Area"}),c.jsx("p",{className:"text-xl mb-8 opacity-90",children:"Enter your postcode to discover reliable locksmith services near you. Quick, easy, and secure."}),c.jsxs("form",{onSubmit:t,className:"join w-full max-w-md mx-auto",children:[c.jsx("input",{className:"input input-bordered join-item flex-1 text-neutral",placeholder:"Enter your postcode",type:"text",value:s,onChange:r=>e(r.target.value),required:!0}),c.jsxs("button",{type:"submit",className:"btn join-item bg-white text-neutral hover:bg-neutral hover:text-white",children:[c.jsx(ks,{className:"h-4 w-4 mr-2"}),"Find"]})]})]})})})}function ya(){return c.jsx("section",{id:"features",className:"py-24 bg-base-100",children:c.jsxs("div",{className:"container mx-auto px-4",children:[c.jsx("h2",{className:"text-3xl font-bold text-center mb-12",children:"Why Choose Us"}),c.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[{icon:Pt,title:"24/7 Service",description:"Round-the-clock availability for all your locksmith needs."},{icon:Vn,title:"Vetted Professionals",description:"All our locksmiths are thoroughly checked and certified."},{icon:Ot,title:"Local Experts",description:"Find skilled locksmiths in your area quickly and easily."}].map((s,e)=>c.jsx("div",{className:"card bg-base-100 shadow-xl",children:c.jsxs("div",{className:"card-body items-center text-center",children:[c.jsx("div",{className:"w-16 h-16 rounded-full bg-neutral flex items-center justify-center mb-4",children:c.jsx(s.icon,{className:"h-8 w-8 text-white"})}),c.jsx("h3",{className:"card-title",children:s.title}),c.jsx("p",{className:"text-base-content/80",children:s.description})]})},e))})]})})}function wa(){const s=[{icon:ks,title:"1. Enter Your Postcode",description:"Simply input your postcode to find locksmiths in your area."},{icon:Sr,title:"2. Choose a Locksmith",description:"Browse through verified professionals and select the best fit for you."},{icon:Pt,title:"3. Get Quick Service",description:"Connect with your chosen locksmith and get the help you need fast."}];return c.jsx("section",{id:"how-it-works",className:"py-24 bg-base-200",children:c.jsxs("div",{className:"container mx-auto px-4",children:[c.jsx("h2",{className:"text-3xl font-bold text-center mb-12",children:"How It Works"}),c.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:s.map((e,t)=>c.jsxs("div",{className:"flex flex-col items-center text-center",children:[c.jsx("div",{className:"w-16 h-16 rounded-full bg-neutral flex items-center justify-center mb-4",children:c.jsx(e.icon,{className:"h-8 w-8 text-white"})}),c.jsx("h3",{className:"text-xl font-bold mb-2",children:e.title}),c.jsx("p",{className:"text-base-content/80",children:e.description})]},t))})]})})}function ka(){const s=[{icon:Tt,title:"Residential Services",subtitle:"Home lockouts, lock changes, and repairs",items:["Emergency lockout assistance","Lock installation and repair","Key cutting and duplication","Security upgrades"]},{icon:xs,title:"Automotive Services",subtitle:"Vehicle lockouts and key services",items:["Car lockout assistance","Car key replacement","Transponder key programming","Broken key extraction"]}];return c.jsx("section",{id:"services",className:"py-24 bg-base-100",children:c.jsxs("div",{className:"container mx-auto px-4",children:[c.jsx("h2",{className:"text-3xl font-bold text-center mb-12",children:"Our Services"}),c.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl mx-auto",children:s.map((e,t)=>c.jsx("div",{className:"card bg-base-100 shadow-xl",children:c.jsxs("div",{className:"card-body",children:[c.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[c.jsx("div",{className:"w-12 h-12 rounded-full bg-neutral flex items-center justify-center",children:c.jsx(e.icon,{className:"h-6 w-6 text-white"})}),c.jsxs("div",{children:[c.jsx("h3",{className:"card-title",children:e.title}),c.jsx("p",{className:"text-base-content/80",children:e.subtitle})]})]}),c.jsx("ul",{className:"space-y-2 text-base-content/80",children:e.items.map((r,i)=>c.jsxs("li",{children:[" ",r]},i))})]})},t))})]})})}function xa(){const s=ws(),[e,t]=m.useState(""),r=i=>{i.preventDefault(),e.trim()&&s(`/find?postcode=${encodeURIComponent(e.trim())}`)};return c.jsxs("div",{className:"flex flex-col min-h-screen",children:[c.jsx(va,{}),c.jsxs("main",{className:"flex-1",children:[c.jsx(_a,{postcode:e,onPostcodeChange:t,onSubmit:r}),c.jsx(ya,{}),c.jsx(wa,{}),c.jsx(ka,{})]}),c.jsx(ba,{})]})}function ja({mapRef:s,viewport:e,onMove:t,hasSearched:r,searchLocation:i,availableLocksmiths:n,onMarkerClick:o}){const[a,l]=m.useState(null),d="pk.eyJ1IjoibWlzdGVyY3JlYXNlIiwiYSI6ImNtMmV0d20xNTAyODgyaXNjNTg4MHZobHUifQ.6wMDQBDPbrNzRUCE4l035g";m.useEffect(()=>{console.log("MapView update:",{hasToken:!!d,locksmiths:n.length,viewport:e,searchLocation:i})},[d,n,e,i]);const u=f=>{var p;console.error("Map error:",f),l(((p=f.error)==null?void 0:p.message)||"Failed to load map")},h=()=>{console.log("Map loaded successfully"),l(null)};return c.jsx(c.Fragment,{children:c.jsxs(Qn,{ref:s,style:{width:"100%",height:"100%"},mapStyle:"mapbox://styles/mapbox/streets-v12",mapboxAccessToken:d,onError:u,onLoad:h,attributionControl:!0,reuseMaps:!0,...e,onMove:t,children:[a&&c.jsx("div",{className:"absolute top-0 left-0 right-0 z-50",children:c.jsxs("div",{className:"alert alert-error max-w-md mx-auto mt-4",children:[c.jsx(Er,{className:"h-5 w-5"}),c.jsx("span",{children:a})]})}),r&&i&&c.jsx(Gs,{latitude:i.latitude,longitude:i.longitude,anchor:"bottom",children:c.jsx("div",{className:"animate-bounce",children:c.jsx(Ot,{className:"h-8 w-8 text-primary stroke-2"})})}),r&&n.map((f,p)=>(console.log("Rendering marker:",{company:f.companyName,lat:f.latitude,lng:f.longitude}),c.jsx(Gs,{latitude:f.latitude,longitude:f.longitude,anchor:"bottom",children:c.jsx("button",{className:"btn btn-circle btn-sm bg-primary text-primary-content hover:bg-primary-focus",onClick:()=>o(f),children:p+1})},f.id)))]})})}function Sa({postcode:s,service:e,searching:t,onPostcodeChange:r,onServiceChange:i,onSubmit:n}){const[o,a]=m.useState(!0);return c.jsxs(c.Fragment,{children:[c.jsx("button",{onClick:()=>a(!o),className:"fixed top-4 left-4 z-20 btn btn-circle lg:hidden","aria-label":o?"Collapse search":"Expand search",children:o?c.jsx(qs,{className:"w-5 h-5"}):c.jsx(qn,{className:"w-5 h-5"})}),c.jsx("div",{className:`fixed top-0 left-0 z-10 h-full transition-transform duration-300 lg:transition-none lg:transform-none lg:top-4 lg:left-4 lg:h-auto ${o?"translate-x-0":"-translate-x-full"}`,children:c.jsx("div",{className:"card bg-base-100 shadow-xl w-80 h-full lg:h-auto",children:c.jsxs("div",{className:"card-body",children:[c.jsx("div",{className:"flex justify-end lg:hidden -mt-2 -mr-2 mb-4",children:c.jsx("button",{onClick:()=>a(!1),className:"btn btn-ghost btn-sm btn-circle",children:c.jsx(qs,{className:"w-4 h-4"})})}),c.jsxs("form",{onSubmit:n,className:"space-y-4",children:[c.jsxs("div",{className:"form-control",children:[c.jsx("label",{className:"label",children:c.jsx("span",{className:"label-text",children:"Enter your Postcode"})}),c.jsx("input",{type:"text",placeholder:"e.g., SW1A 1AA",value:s,onChange:l=>r(l.target.value),className:"input input-bordered w-full"})]}),c.jsxs("div",{className:"form-control",children:[c.jsx("label",{className:"label",children:c.jsx("span",{className:"label-text",children:"Service Type"})}),c.jsxs("div",{className:"join w-full",children:[c.jsxs("button",{type:"button",className:`join-item btn flex-1 ${e==="home"?"btn-primary":"btn-ghost"}`,onClick:()=>i("home"),children:[c.jsx(Tt,{className:"w-4 h-4 mr-2"})," Home"]}),c.jsxs("button",{type:"button",className:`join-item btn flex-1 ${e==="car"?"btn-primary":"btn-ghost"}`,onClick:()=>i("car"),children:[c.jsx(xs,{className:"w-4 h-4 mr-2"})," Vehicle"]})]})]}),c.jsxs("button",{type:"submit",className:`btn btn-primary w-full ${t?"loading":""}`,disabled:t,children:[!t&&c.jsx(ks,{className:"w-4 h-4 mr-2"}),t?"Searching...":"Find Locksmiths"]})]})]})})})]})}function Ea({onReset:s}){return c.jsxs("div",{className:"text-center py-6",children:[c.jsx("div",{className:"bg-base-200 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4",children:c.jsxs("svg",{className:"w-8 h-8 text-base-content/60",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]})}),c.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Locksmiths Found"}),c.jsx("p",{className:"text-base-content/80 mb-4",children:"Sorry, we couldn't find any locksmiths that currently service your area. Try searching a different postcode or changing the service type."}),c.jsx("button",{className:"btn btn-primary",onClick:s,children:"New Search"})]})}function Ca({locksmiths:s,onLocksmithSelect:e}){return c.jsxs("div",{className:"space-y-4",children:[c.jsx("h2",{className:"text-lg font-semibold",children:"Available Locksmiths"}),c.jsx("div",{className:"space-y-2",children:s.map((t,r)=>c.jsx("div",{className:"card bg-base-100 shadow-sm hover:shadow-md transition-shadow cursor-pointer",onClick:()=>e(t),children:c.jsx("div",{className:"card-body p-4",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:"badge badge-primary badge-lg",children:r+1}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("h3",{className:"font-medium truncate",children:t.companyName}),c.jsxs("div",{className:"flex items-center text-base-content/60 text-sm",children:[c.jsx(Pt,{className:"w-4 h-4 mr-1"}),c.jsxs("span",{children:["ETA: ",t.eta," min"]})]})]})]})})},t.id))})]})}function Pa({locksmith:s,onBack:e}){return c.jsxs("div",{className:"space-y-6",children:[c.jsx("div",{className:"flex items-center gap-2",children:c.jsxs("button",{onClick:e,className:"btn btn-ghost btn-sm",children:[c.jsx(Hn,{className:"w-4 h-4"}),"Back to results"]})}),c.jsxs("div",{children:[c.jsx("h2",{className:"text-2xl font-bold mb-2",children:s.companyName}),s.eta!==void 0&&c.jsxs("div",{className:"flex items-center text-base-content/60",children:[c.jsx(Pt,{className:"w-4 h-4 mr-1"}),c.jsxs("span",{children:["ETA: ",s.eta," min"]})]})]}),c.jsx("div",{className:"divider"}),c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[s.telephoneNumber&&c.jsxs("a",{href:`tel:${s.telephoneNumber}`,className:"btn btn-primary",children:[c.jsx(Sr,{className:"w-5 h-5 mr-2"}),"Call Now"]}),s.website&&c.jsxs("a",{href:s.website,target:"_blank",rel:"noopener noreferrer",className:"btn btn-ghost",children:[c.jsx(Gn,{className:"w-4 h-4 mr-2"}),"Visit Website"]})]}),c.jsxs("div",{className:"flex items-center text-base-content/60",children:[c.jsx(Ot,{className:"w-4 h-4 mr-2"}),c.jsxs("span",{children:["Service radius: ",s.serviceRadius,"km"]})]}),c.jsxs("div",{children:[c.jsx("h3",{className:"font-bold mb-2",children:"Services Offered:"}),c.jsxs("div",{className:"flex gap-2",children:[s.servicesOffered.includes("home")&&c.jsxs("div",{className:"badge badge-outline gap-1",children:[c.jsx(Tt,{className:"w-3 h-3"}),"Home"]}),s.servicesOffered.includes("car")&&c.jsxs("div",{className:"badge badge-outline gap-1",children:[c.jsx(xs,{className:"w-3 h-3"}),"Vehicle"]})]})]})]})]})}function Oa({hasSearched:s,selectedLocksmith:e,availableLocksmiths:t,onLocksmithSelect:r,onBack:i,onReset:n}){return s?c.jsx("div",{className:"fixed bottom-4 w-full px-4 max-w-lg mx-auto left-0 right-0 z-10",children:c.jsx("div",{className:"card bg-base-100 shadow-xl",children:c.jsx("div",{className:"card-body p-4 max-h-[60vh] overflow-y-auto",children:e?c.jsx(Pa,{locksmith:e,onBack:i}):t.length>0?c.jsx(Ca,{locksmiths:t,onLocksmithSelect:r}):c.jsx(Ea,{onReset:n})})})}):null}function Ta(){const[s,e]=m.useState(null),[t,r]=m.useState(null);return m.useEffect(()=>{const i="pk.eyJ1IjoibWlzdGVyY3JlYXNlIiwiYSI6ImNtMmV0d20xNTAyODgyaXNjNTg4MHZobHUifQ.6wMDQBDPbrNzRUCE4l035g";if(!i.startsWith("pk.")){r("Invalid Mapbox access token format");return}e(i),r(null)},[]),{mapboxToken:s,error:t}}const Na=s=>{let e;return s?e=s:typeof fetch>"u"?e=(...t)=>We(async()=>{const{default:r}=await Promise.resolve().then(()=>Ge);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)};class As extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class Ra extends As{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Aa extends As{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Ia extends As{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var ps;(function(s){s.Any="any",s.ApNortheast1="ap-northeast-1",s.ApNortheast2="ap-northeast-2",s.ApSouth1="ap-south-1",s.ApSoutheast1="ap-southeast-1",s.ApSoutheast2="ap-southeast-2",s.CaCentral1="ca-central-1",s.EuCentral1="eu-central-1",s.EuWest1="eu-west-1",s.EuWest2="eu-west-2",s.EuWest3="eu-west-3",s.SaEast1="sa-east-1",s.UsEast1="us-east-1",s.UsWest1="us-west-1",s.UsWest2="us-west-2"})(ps||(ps={}));var La=function(s,e,t,r){function i(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(u){try{d(r.next(u))}catch(h){o(h)}}function l(u){try{d(r.throw(u))}catch(h){o(h)}}function d(u){u.done?n(u.value):i(u.value).then(a,l)}d((r=r.apply(s,e||[])).next())})};class Ua{constructor(e,{headers:t={},customFetch:r,region:i=ps.Any}={}){this.url=e,this.headers=t,this.region=i,this.fetch=Na(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return La(this,void 0,void 0,function*(){try{const{headers:i,method:n,body:o}=t;let a={},{region:l}=t;l||(l=this.region),l&&l!=="any"&&(a["x-region"]=l);let d;o&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",d=o):typeof o=="string"?(a["Content-Type"]="text/plain",d=o):typeof FormData<"u"&&o instanceof FormData?d=o:(a["Content-Type"]="application/json",d=JSON.stringify(o)));const u=yield this.fetch(`${this.url}/${e}`,{method:n||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),i),body:d}).catch(g=>{throw new Ra(g)}),h=u.headers.get("x-relay-error");if(h&&h==="true")throw new Aa(u);if(!u.ok)throw new Ia(u);let f=((r=u.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),p;return f==="application/json"?p=yield u.json():f==="application/octet-stream"?p=yield u.blob():f==="text/event-stream"?p=u:f==="multipart/form-data"?p=yield u.formData():p=yield u.text(),{data:p,error:null}}catch(i){return{data:null,error:i}}})}}var Q={},Is={},Lt={},ut={},Ut={},$t={},$a=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},qe=$a();const Da=qe.fetch,ln=qe.fetch.bind(qe),cn=qe.Headers,Ma=qe.Request,za=qe.Response,Ge=Object.freeze(Object.defineProperty({__proto__:null,Headers:cn,Request:Ma,Response:za,default:ln,fetch:Da},Symbol.toStringTag,{value:"Module"})),Fa=Ln(Ge);var Dt={};Object.defineProperty(Dt,"__esModule",{value:!0});class Ba extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}}Dt.default=Ba;var un=Z&&Z.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty($t,"__esModule",{value:!0});const Wa=un(Fa),Va=un(Dt);let qa=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=Wa.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Object.assign({},this.headers),this.headers[e]=t,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const r=this.fetch;let i=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async n=>{var o,a,l;let d=null,u=null,h=null,f=n.status,p=n.statusText;if(n.ok){if(this.method!=="HEAD"){const b=await n.text();b===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?u=b:u=JSON.parse(b))}const _=(o=this.headers.Prefer)===null||o===void 0?void 0:o.match(/count=(exact|planned|estimated)/),w=(a=n.headers.get("content-range"))===null||a===void 0?void 0:a.split("/");_&&w&&w.length>1&&(h=parseInt(w[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(u)&&(u.length>1?(d={code:"PGRST116",details:`Results contain ${u.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},u=null,h=null,f=406,p="Not Acceptable"):u.length===1?u=u[0]:u=null)}else{const _=await n.text();try{d=JSON.parse(_),Array.isArray(d)&&n.status===404&&(u=[],d=null,f=200,p="OK")}catch{n.status===404&&_===""?(f=204,p="No Content"):d={message:_}}if(d&&this.isMaybeSingle&&(!((l=d==null?void 0:d.details)===null||l===void 0)&&l.includes("0 rows"))&&(d=null,f=200,p="OK"),d&&this.shouldThrowOnError)throw new Va.default(d)}return{error:d,data:u,count:h,status:f,statusText:p}});return this.shouldThrowOnError||(i=i.catch(n=>{var o,a,l;return{error:{message:`${(o=n==null?void 0:n.name)!==null&&o!==void 0?o:"FetchError"}: ${n==null?void 0:n.message}`,details:`${(a=n==null?void 0:n.stack)!==null&&a!==void 0?a:""}`,hint:"",code:`${(l=n==null?void 0:n.code)!==null&&l!==void 0?l:""}`},data:null,count:null,status:0,statusText:""}})),i.then(e,t)}};$t.default=qa;var Ha=Z&&Z.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Ut,"__esModule",{value:!0});const Ga=Ha($t);let Ka=class extends Ga.default{select(e){let t=!1;const r=(e??"*").split("").map(i=>/\s/.test(i)&&!t?"":(i==='"'&&(t=!t),i)).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:i,referencedTable:n=i}={}){const o=n?`${n}.order`:"order",a=this.url.searchParams.get(o);return this.url.searchParams.set(o,`${a?`${a},`:""}${e}.${t?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:r=t}={}){const i=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(i,`${e}`),this}range(e,t,{foreignTable:r,referencedTable:i=r}={}){const n=typeof i>"u"?"offset":`${i}.offset`,o=typeof i>"u"?"limit":`${i}.limit`;return this.url.searchParams.set(n,`${e}`),this.url.searchParams.set(o,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:i=!1,wal:n=!1,format:o="text"}={}){var a;const l=[e?"analyze":null,t?"verbose":null,r?"settings":null,i?"buffers":null,n?"wal":null].filter(Boolean).join("|"),d=(a=this.headers.Accept)!==null&&a!==void 0?a:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${o}; for="${d}"; options=${l};`,o==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};Ut.default=Ka;var Ja=Z&&Z.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(ut,"__esModule",{value:!0});const Ya=Ja(Ut);let Qa=class extends Ya.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const r=Array.from(new Set(t)).map(i=>typeof i=="string"&&new RegExp("[,()]").test(i)?`"${i}"`:`${i}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:i}={}){let n="";i==="plain"?n="pl":i==="phrase"?n="ph":i==="websearch"&&(n="w");const o=r===void 0?"":`(${r})`;return this.url.searchParams.append(e,`${n}fts${o}.${t}`),this}match(e){return Object.entries(e).forEach(([t,r])=>{this.url.searchParams.append(t,`eq.${r}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t,referencedTable:r=t}={}){const i=r?`${r}.or`:"or";return this.url.searchParams.append(i,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}};ut.default=Qa;var Xa=Z&&Z.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Lt,"__esModule",{value:!0});const Ze=Xa(ut);let Za=class{constructor(e,{headers:t={},schema:r,fetch:i}){this.url=e,this.headers=t,this.schema=r,this.fetch=i}select(e,{head:t=!1,count:r}={}){const i=t?"HEAD":"GET";let n=!1;const o=(e??"*").split("").map(a=>/\s/.test(a)&&!n?"":(a==='"'&&(n=!n),a)).join("");return this.url.searchParams.set("select",o),r&&(this.headers.Prefer=`count=${r}`),new Ze.default({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:r=!0}={}){const i="POST",n=[];if(this.headers.Prefer&&n.push(this.headers.Prefer),t&&n.push(`count=${t}`),r||n.push("missing=default"),this.headers.Prefer=n.join(","),Array.isArray(e)){const o=e.reduce((a,l)=>a.concat(Object.keys(l)),[]);if(o.length>0){const a=[...new Set(o)].map(l=>`"${l}"`);this.url.searchParams.set("columns",a.join(","))}}return new Ze.default({method:i,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:i,defaultToNull:n=!0}={}){const o="POST",a=[`resolution=${r?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&a.push(this.headers.Prefer),i&&a.push(`count=${i}`),n||a.push("missing=default"),this.headers.Prefer=a.join(","),Array.isArray(e)){const l=e.reduce((d,u)=>d.concat(Object.keys(u)),[]);if(l.length>0){const d=[...new Set(l)].map(u=>`"${u}"`);this.url.searchParams.set("columns",d.join(","))}}return new Ze.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const r="PATCH",i=[];return this.headers.Prefer&&i.push(this.headers.Prefer),t&&i.push(`count=${t}`),this.headers.Prefer=i.join(","),new Ze.default({method:r,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t="DELETE",r=[];return e&&r.push(`count=${e}`),this.headers.Prefer&&r.unshift(this.headers.Prefer),this.headers.Prefer=r.join(","),new Ze.default({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};Lt.default=Za;var Mt={},zt={};Object.defineProperty(zt,"__esModule",{value:!0});zt.version=void 0;zt.version="0.0.0-automated";Object.defineProperty(Mt,"__esModule",{value:!0});Mt.DEFAULT_HEADERS=void 0;const el=zt;Mt.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${el.version}`};var dn=Z&&Z.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Is,"__esModule",{value:!0});const tl=dn(Lt),sl=dn(ut),rl=Mt;let nl=class hn{constructor(e,{headers:t={},schema:r,fetch:i}={}){this.url=e,this.headers=Object.assign(Object.assign({},rl.DEFAULT_HEADERS),t),this.schemaName=r,this.fetch=i}from(e){const t=new URL(`${this.url}/${e}`);return new tl.default(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new hn(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:r=!1,get:i=!1,count:n}={}){let o;const a=new URL(`${this.url}/rpc/${e}`);let l;r||i?(o=r?"HEAD":"GET",Object.entries(t).filter(([u,h])=>h!==void 0).map(([u,h])=>[u,Array.isArray(h)?`{${h.join(",")}}`:`${h}`]).forEach(([u,h])=>{a.searchParams.append(u,h)})):(o="POST",l=t);const d=Object.assign({},this.headers);return n&&(d.Prefer=`count=${n}`),new sl.default({method:o,url:a,headers:d,schema:this.schemaName,body:l,fetch:this.fetch,allowEmpty:!1})}};Is.default=nl;var Ke=Z&&Z.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Q,"__esModule",{value:!0});Q.PostgrestError=Q.PostgrestBuilder=Q.PostgrestTransformBuilder=Q.PostgrestFilterBuilder=Q.PostgrestQueryBuilder=Q.PostgrestClient=void 0;const fn=Ke(Is);Q.PostgrestClient=fn.default;const pn=Ke(Lt);Q.PostgrestQueryBuilder=pn.default;const gn=Ke(ut);Q.PostgrestFilterBuilder=gn.default;const mn=Ke(Ut);Q.PostgrestTransformBuilder=mn.default;const vn=Ke($t);Q.PostgrestBuilder=vn.default;const bn=Ke(Dt);Q.PostgrestError=bn.default;var il=Q.default={PostgrestClient:fn.default,PostgrestQueryBuilder:pn.default,PostgrestFilterBuilder:gn.default,PostgrestTransformBuilder:mn.default,PostgrestBuilder:vn.default,PostgrestError:bn.default};const{PostgrestClient:ol,PostgrestQueryBuilder:hu,PostgrestFilterBuilder:fu,PostgrestTransformBuilder:pu,PostgrestBuilder:gu}=il,al="2.10.7",ll={"X-Client-Info":`realtime-js/${al}`},cl="1.0.0",_n=1e4,ul=1e3;var Be;(function(s){s[s.connecting=0]="connecting",s[s.open=1]="open",s[s.closing=2]="closing",s[s.closed=3]="closed"})(Be||(Be={}));var se;(function(s){s.closed="closed",s.errored="errored",s.joined="joined",s.joining="joining",s.leaving="leaving"})(se||(se={}));var ae;(function(s){s.close="phx_close",s.error="phx_error",s.join="phx_join",s.reply="phx_reply",s.leave="phx_leave",s.access_token="access_token"})(ae||(ae={}));var gs;(function(s){s.websocket="websocket"})(gs||(gs={}));var Re;(function(s){s.Connecting="connecting",s.Open="open",s.Closing="closing",s.Closed="closed"})(Re||(Re={}));class dl{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const i=t.getUint8(1),n=t.getUint8(2);let o=this.HEADER_LENGTH+2;const a=r.decode(e.slice(o,o+i));o=o+i;const l=r.decode(e.slice(o,o+n));o=o+n;const d=JSON.parse(r.decode(e.slice(o,e.byteLength)));return{ref:null,topic:a,event:l,payload:d}}}class yn{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var I;(function(s){s.abstime="abstime",s.bool="bool",s.date="date",s.daterange="daterange",s.float4="float4",s.float8="float8",s.int2="int2",s.int4="int4",s.int4range="int4range",s.int8="int8",s.int8range="int8range",s.json="json",s.jsonb="jsonb",s.money="money",s.numeric="numeric",s.oid="oid",s.reltime="reltime",s.text="text",s.time="time",s.timestamp="timestamp",s.timestamptz="timestamptz",s.timetz="timetz",s.tsrange="tsrange",s.tstzrange="tstzrange"})(I||(I={}));const ir=(s,e,t={})=>{var r;const i=(r=t.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((n,o)=>(n[o]=hl(o,s,e,i),n),{})},hl=(s,e,t,r)=>{const i=e.find(a=>a.name===s),n=i==null?void 0:i.type,o=t[s];return n&&!r.includes(n)?wn(n,o):ms(o)},wn=(s,e)=>{if(s.charAt(0)==="_"){const t=s.slice(1,s.length);return ml(e,t)}switch(s){case I.bool:return fl(e);case I.float4:case I.float8:case I.int2:case I.int4:case I.int8:case I.numeric:case I.oid:return pl(e);case I.json:case I.jsonb:return gl(e);case I.timestamp:return vl(e);case I.abstime:case I.date:case I.daterange:case I.int4range:case I.int8range:case I.money:case I.reltime:case I.text:case I.time:case I.timestamptz:case I.timetz:case I.tsrange:case I.tstzrange:return ms(e);default:return ms(e)}},ms=s=>s,fl=s=>{switch(s){case"t":return!0;case"f":return!1;default:return s}},pl=s=>{if(typeof s=="string"){const e=parseFloat(s);if(!Number.isNaN(e))return e}return s},gl=s=>{if(typeof s=="string")try{return JSON.parse(s)}catch(e){return console.log(`JSON parse error: ${e}`),s}return s},ml=(s,e)=>{if(typeof s!="string")return s;const t=s.length-1,r=s[t];if(s[0]==="{"&&r==="}"){let n;const o=s.slice(1,t);try{n=JSON.parse("["+o+"]")}catch{n=o?o.split(","):[]}return n.map(a=>wn(e,a))}return s},vl=s=>typeof s=="string"?s.replace(" ","T"):s,kn=s=>{let e=s;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class es{constructor(e,t,r={},i=_n){this.channel=e,this.event=t,this.payload=r,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var or;(function(s){s.SYNC="sync",s.JOIN="join",s.LEAVE="leave"})(or||(or={}));class it{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},i=>{const{onJoin:n,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=it.syncState(this.state,i,n,o),this.pendingDiffs.forEach(l=>{this.state=it.syncDiff(this.state,l,n,o)}),this.pendingDiffs=[],a()}),this.channel._on(r.diff,{},i=>{const{onJoin:n,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(i):(this.state=it.syncDiff(this.state,i,n,o),a())}),this.onJoin((i,n,o)=>{this.channel._trigger("presence",{event:"join",key:i,currentPresences:n,newPresences:o})}),this.onLeave((i,n,o)=>{this.channel._trigger("presence",{event:"leave",key:i,currentPresences:n,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,i){const n=this.cloneDeep(e),o=this.transformState(t),a={},l={};return this.map(n,(d,u)=>{o[d]||(l[d]=u)}),this.map(o,(d,u)=>{const h=n[d];if(h){const f=u.map(w=>w.presence_ref),p=h.map(w=>w.presence_ref),g=u.filter(w=>p.indexOf(w.presence_ref)<0),_=h.filter(w=>f.indexOf(w.presence_ref)<0);g.length>0&&(a[d]=g),_.length>0&&(l[d]=_)}else a[d]=u}),this.syncDiff(n,{joins:a,leaves:l},r,i)}static syncDiff(e,t,r,i){const{joins:n,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),i||(i=()=>{}),this.map(n,(a,l)=>{var d;const u=(d=e[a])!==null&&d!==void 0?d:[];if(e[a]=this.cloneDeep(l),u.length>0){const h=e[a].map(p=>p.presence_ref),f=u.filter(p=>h.indexOf(p.presence_ref)<0);e[a].unshift(...f)}r(a,u,l)}),this.map(o,(a,l)=>{let d=e[a];if(!d)return;const u=l.map(h=>h.presence_ref);d=d.filter(h=>u.indexOf(h.presence_ref)<0),e[a]=d,i(a,d,l),d.length===0&&delete e[a]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const i=e[r];return"metas"in i?t[r]=i.metas.map(n=>(n.presence_ref=n.phx_ref,delete n.phx_ref,delete n.phx_ref_prev,n)):t[r]=i,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var ar;(function(s){s.ALL="*",s.INSERT="INSERT",s.UPDATE="UPDATE",s.DELETE="DELETE"})(ar||(ar={}));var lr;(function(s){s.BROADCAST="broadcast",s.PRESENCE="presence",s.POSTGRES_CHANGES="postgres_changes",s.SYSTEM="system"})(lr||(lr={}));var cr;(function(s){s.SUBSCRIBED="SUBSCRIBED",s.TIMED_OUT="TIMED_OUT",s.CLOSED="CLOSED",s.CHANNEL_ERROR="CHANNEL_ERROR"})(cr||(cr={}));class Ls{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=se.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new es(this,ae.join,this.params,this.timeout),this.rejoinTimer=new yn(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=se.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(i=>i.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=se.closed,this.socket._remove(this)}),this._onError(i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=se.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=se.errored,this.rejoinTimer.scheduleTimeout())}),this._on(ae.reply,{},(i,n)=>{this._trigger(this._replyEventName(n),i)}),this.presence=new it(this),this.broadcastEndpointURL=kn(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var r,i;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:n,presence:o,private:a}}=this.params;this._onError(u=>e&&e("CHANNEL_ERROR",u)),this._onClose(()=>e&&e("CLOSED"));const l={},d={broadcast:n,presence:o,postgres_changes:(i=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(u=>u.filter))!==null&&i!==void 0?i:[],private:a};this.socket.accessToken&&(l.access_token=this.socket.accessToken),this.updateJoinPayload(Object.assign({config:d},l)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",({postgres_changes:u})=>{var h;if(this.socket.accessToken&&this.socket.setAuth(this.socket.accessToken),u===void 0){e&&e("SUBSCRIBED");return}else{const f=this.bindings.postgres_changes,p=(h=f==null?void 0:f.length)!==null&&h!==void 0?h:0,g=[];for(let _=0;_<p;_++){const w=f[_],{filter:{event:b,schema:N,table:R,filter:T}}=w,O=u&&u[_];if(O&&O.event===b&&O.schema===N&&O.table===R&&O.filter===T)g.push(Object.assign(Object.assign({},w),{id:O.id}));else{this.unsubscribe(),e&&e("CHANNEL_ERROR",new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=g,e&&e("SUBSCRIBED");return}}).receive("error",u=>{e&&e("CHANNEL_ERROR",new Error(JSON.stringify(Object.values(u).join(", ")||"error")))}).receive("timeout",()=>{e&&e("TIMED_OUT")})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this._on(e,t,r)}async send(e,t={}){var r,i;if(!this._canPush()&&e.type==="broadcast"){const{event:n,payload:o}=e,a={method:"POST",headers:{Authorization:this.socket.accessToken?`Bearer ${this.socket.accessToken}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:n,payload:o,private:this.private}]})};try{const l=await this._fetchWithTimeout(this.broadcastEndpointURL,a,(r=t.timeout)!==null&&r!==void 0?r:this.timeout);return await((i=l.body)===null||i===void 0?void 0:i.cancel()),l.ok?"ok":"error"}catch(l){return l.name==="AbortError"?"timed out":"error"}}else return new Promise(n=>{var o,a,l;const d=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&n("ok"),d.receive("ok",()=>n("ok")),d.receive("error",()=>n("error")),d.receive("timeout",()=>n("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=se.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(ae.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(r=>{const i=new es(this,ae.leave,{},e);i.receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),i.send(),this._canPush()||i.trigger("ok",{})})}async _fetchWithTimeout(e,t,r){const i=new AbortController,n=setTimeout(()=>i.abort(),r),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:i.signal}));return clearTimeout(n),o}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new es(this,e,t,r);return this._canPush()?i.send():(i.startTimeout(),this.pushBuffer.push(i)),i}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var i,n;const o=e.toLocaleLowerCase(),{close:a,error:l,leave:d,join:u}=ae;if(r&&[a,l,d,u].indexOf(o)>=0&&r!==this._joinRef())return;let f=this._onMessage(o,t,r);if(t&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(i=this.bindings.postgres_changes)===null||i===void 0||i.filter(p=>{var g,_,w;return((g=p.filter)===null||g===void 0?void 0:g.event)==="*"||((w=(_=p.filter)===null||_===void 0?void 0:_.event)===null||w===void 0?void 0:w.toLocaleLowerCase())===o}).map(p=>p.callback(f,r)):(n=this.bindings[o])===null||n===void 0||n.filter(p=>{var g,_,w,b,N,R;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in p){const T=p.id,O=(g=p.filter)===null||g===void 0?void 0:g.event;return T&&((_=t.ids)===null||_===void 0?void 0:_.includes(T))&&(O==="*"||(O==null?void 0:O.toLocaleLowerCase())===((w=t.data)===null||w===void 0?void 0:w.type.toLocaleLowerCase()))}else{const T=(N=(b=p==null?void 0:p.filter)===null||b===void 0?void 0:b.event)===null||N===void 0?void 0:N.toLocaleLowerCase();return T==="*"||T===((R=t==null?void 0:t.event)===null||R===void 0?void 0:R.toLocaleLowerCase())}else return p.type.toLocaleLowerCase()===o}).map(p=>{if(typeof f=="object"&&"ids"in f){const g=f.data,{schema:_,table:w,commit_timestamp:b,type:N,errors:R}=g;f=Object.assign(Object.assign({},{schema:_,table:w,commit_timestamp:b,eventType:N,new:{},old:{},errors:R}),this._getPayloadRecords(g))}p.callback(f,r)})}_isClosed(){return this.state===se.closed}_isJoined(){return this.state===se.joined}_isJoining(){return this.state===se.joining}_isLeaving(){return this.state===se.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const i=e.toLocaleLowerCase(),n={type:i,filter:t,callback:r};return this.bindings[i]?this.bindings[i].push(n):this.bindings[i]=[n],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(i=>{var n;return!(((n=i.type)===null||n===void 0?void 0:n.toLocaleLowerCase())===r&&Ls.isEqual(i.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(ae.close,{},e)}_onError(e){this._on(ae.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=se.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=ir(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=ir(e.columns,e.old_record)),t}}const bl=()=>{},_l=typeof WebSocket<"u",yl=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class wl{constructor(e,t){var r;this.accessToken=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=ll,this.params={},this.timeout=_n,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=bl,this.conn=null,this.sendBuffer=[],this.serializer=new dl,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this._resolveFetch=n=>{let o;return n?o=n:typeof fetch>"u"?o=(...a)=>We(async()=>{const{default:l}=await Promise.resolve().then(()=>Ge);return{default:l}},void 0).then(({default:l})=>l(...a)):o=fetch,(...a)=>o(...a)},this.endPoint=`${e}/${gs.websocket}`,this.httpEndpoint=kn(e),t!=null&&t.transport?this.transport=t.transport:this.transport=null,t!=null&&t.params&&(this.params=t.params),t!=null&&t.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const i=(r=t==null?void 0:t.params)===null||r===void 0?void 0:r.apikey;if(i&&(this.accessToken=i,this.apiKey=i),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:n=>[1e3,2e3,5e3,1e4][n-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(n,o)=>o(JSON.stringify(n)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new yn(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t==null?void 0:t.fetch),t!=null&&t.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(t==null?void 0:t.worker)||!1,this.workerUrl=t==null?void 0:t.workerUrl}}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this._endPointURL(),void 0,{headers:this.headers});return}if(_l){this.conn=new WebSocket(this._endPointURL()),this.setupConnection();return}this.conn=new kl(this._endPointURL(),void 0,{close:()=>{this.conn=null}}),We(async()=>{const{default:e}=await import("./browser-wb85aNMu.js").then(t=>t.b);return{default:e}},__vite__mapDeps([0,1])).then(({default:e})=>{this.conn=new e(this._endPointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case Be.connecting:return Re.Connecting;case Be.open:return Re.Open;case Be.closing:return Re.Closing;default:return Re.Closed}}isConnected(){return this.connectionState()===Re.Open}channel(e,t={config:{}}){const r=new Ls(`realtime:${e}`,t,this);return this.channels.push(r),r}push(e){const{topic:t,event:r,payload:i,ref:n}=e,o=()=>{this.encode(e,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${t} ${r} (${n})`,i),this.isConnected()?o():this.sendBuffer.push(o)}setAuth(e){this.accessToken=e,this.channels.forEach(t=>{e&&t.updateJoinPayload({access_token:e}),t.joinedOnce&&t._isJoined()&&t._push(ae.access_token,{access_token:e})})}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:cl}))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:r,event:i,payload:n,ref:o}=t;(o&&o===this.pendingHeartbeatRef||i===(n==null?void 0:n.type))&&(this.pendingHeartbeatRef=null),this.log("receive",`${n.status||""} ${r} ${i} ${o&&"("+o+")"||""}`,n),this.channels.filter(a=>a._isMember(r)).forEach(a=>a._trigger(i,n,o)),this.stateChangeCallbacks.message.forEach(a=>a(t))})}async _onConnOpen(){if(this.log("transport",`connected to ${this._endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),!this.worker)this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs);else{this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this._sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(ae.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",i=new URLSearchParams(t);return`${e}${r}${i}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(ul,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}_workerObjectUrl(e){let t;if(e)t=e;else{const r=new Blob([yl],{type:"application/javascript"});t=URL.createObjectURL(r)}return t}}class kl{constructor(e,t,r){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=Be.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=r.close}}class Us extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function F(s){return typeof s=="object"&&s!==null&&"__isStorageError"in s}class xl extends Us{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class vs extends Us{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var jl=function(s,e,t,r){function i(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(u){try{d(r.next(u))}catch(h){o(h)}}function l(u){try{d(r.throw(u))}catch(h){o(h)}}function d(u){u.done?n(u.value):i(u.value).then(a,l)}d((r=r.apply(s,e||[])).next())})};const xn=s=>{let e;return s?e=s:typeof fetch>"u"?e=(...t)=>We(async()=>{const{default:r}=await Promise.resolve().then(()=>Ge);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},Sl=()=>jl(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield We(()=>Promise.resolve().then(()=>Ge),void 0)).Response:Response}),bs=s=>{if(Array.isArray(s))return s.map(t=>bs(t));if(typeof s=="function"||s!==Object(s))return s;const e={};return Object.entries(s).forEach(([t,r])=>{const i=t.replace(/([-_][a-z])/gi,n=>n.toUpperCase().replace(/[-_]/g,""));e[i]=bs(r)}),e};var Ie=function(s,e,t,r){function i(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(u){try{d(r.next(u))}catch(h){o(h)}}function l(u){try{d(r.throw(u))}catch(h){o(h)}}function d(u){u.done?n(u.value):i(u.value).then(a,l)}d((r=r.apply(s,e||[])).next())})};const ts=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),El=(s,e,t)=>Ie(void 0,void 0,void 0,function*(){const r=yield Sl();s instanceof r&&!(t!=null&&t.noResolveJson)?s.json().then(i=>{e(new xl(ts(i),s.status||500))}).catch(i=>{e(new vs(ts(i),i))}):e(new vs(ts(s),s))}),Cl=(s,e,t,r)=>{const i={method:s,headers:(e==null?void 0:e.headers)||{}};return s==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),r&&(i.body=JSON.stringify(r)),Object.assign(Object.assign({},i),t))};function dt(s,e,t,r,i,n){return Ie(this,void 0,void 0,function*(){return new Promise((o,a)=>{s(t,Cl(e,r,i,n)).then(l=>{if(!l.ok)throw l;return r!=null&&r.noResolveJson?l:l.json()}).then(l=>o(l)).catch(l=>El(l,a,r))})})}function Ct(s,e,t,r){return Ie(this,void 0,void 0,function*(){return dt(s,"GET",e,t,r)})}function we(s,e,t,r,i){return Ie(this,void 0,void 0,function*(){return dt(s,"POST",e,r,i,t)})}function Pl(s,e,t,r,i){return Ie(this,void 0,void 0,function*(){return dt(s,"PUT",e,r,i,t)})}function Ol(s,e,t,r){return Ie(this,void 0,void 0,function*(){return dt(s,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),r)})}function jn(s,e,t,r,i){return Ie(this,void 0,void 0,function*(){return dt(s,"DELETE",e,r,i,t)})}var Y=function(s,e,t,r){function i(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(u){try{d(r.next(u))}catch(h){o(h)}}function l(u){try{d(r.throw(u))}catch(h){o(h)}}function d(u){u.done?n(u.value):i(u.value).then(a,l)}d((r=r.apply(s,e||[])).next())})};const Tl={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},ur={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Nl{constructor(e,t={},r,i){this.url=e,this.headers=t,this.bucketId=r,this.fetch=xn(i)}uploadOrUpdate(e,t,r,i){return Y(this,void 0,void 0,function*(){try{let n;const o=Object.assign(Object.assign({},ur),i);let a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const l=o.metadata;typeof Blob<"u"&&r instanceof Blob?(n=new FormData,n.append("cacheControl",o.cacheControl),l&&n.append("metadata",this.encodeMetadata(l)),n.append("",r)):typeof FormData<"u"&&r instanceof FormData?(n=r,n.append("cacheControl",o.cacheControl),l&&n.append("metadata",this.encodeMetadata(l))):(n=r,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,l&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(l)))),i!=null&&i.headers&&(a=Object.assign(Object.assign({},a),i.headers));const d=this._removeEmptyFolders(t),u=this._getFinalPath(d),h=yield this.fetch(`${this.url}/object/${u}`,Object.assign({method:e,body:n,headers:a},o!=null&&o.duplex?{duplex:o.duplex}:{})),f=yield h.json();return h.ok?{data:{path:d,id:f.Id,fullPath:f.Key},error:null}:{data:null,error:f}}catch(n){if(F(n))return{data:null,error:n};throw n}})}upload(e,t,r){return Y(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,i){return Y(this,void 0,void 0,function*(){const n=this._removeEmptyFolders(e),o=this._getFinalPath(n),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set("token",t);try{let l;const d=Object.assign({upsert:ur.upsert},i),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(d.upsert)});typeof Blob<"u"&&r instanceof Blob?(l=new FormData,l.append("cacheControl",d.cacheControl),l.append("",r)):typeof FormData<"u"&&r instanceof FormData?(l=r,l.append("cacheControl",d.cacheControl)):(l=r,u["cache-control"]=`max-age=${d.cacheControl}`,u["content-type"]=d.contentType);const h=yield this.fetch(a.toString(),{method:"PUT",body:l,headers:u}),f=yield h.json();return h.ok?{data:{path:n,fullPath:f.Key},error:null}:{data:null,error:f}}catch(l){if(F(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e,t){return Y(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const i=Object.assign({},this.headers);t!=null&&t.upsert&&(i["x-upsert"]="true");const n=yield we(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:i}),o=new URL(this.url+n.url),a=o.searchParams.get("token");if(!a)throw new Us("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:a},error:null}}catch(r){if(F(r))return{data:null,error:r};throw r}})}update(e,t,r){return Y(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return Y(this,void 0,void 0,function*(){try{return{data:yield we(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(i){if(F(i))return{data:null,error:i};throw i}})}copy(e,t,r){return Y(this,void 0,void 0,function*(){try{return{data:{path:(yield we(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(i){if(F(i))return{data:null,error:i};throw i}})}createSignedUrl(e,t,r){return Y(this,void 0,void 0,function*(){try{let i=this._getFinalPath(e),n=yield we(this.fetch,`${this.url}/object/sign/${i}`,Object.assign({expiresIn:t},r!=null&&r.transform?{transform:r.transform}:{}),{headers:this.headers});const o=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return n={signedUrl:encodeURI(`${this.url}${n.signedURL}${o}`)},{data:n,error:null}}catch(i){if(F(i))return{data:null,error:i};throw i}})}createSignedUrls(e,t,r){return Y(this,void 0,void 0,function*(){try{const i=yield we(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),n=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:i.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${n}`):null})),error:null}}catch(i){if(F(i))return{data:null,error:i};throw i}})}download(e,t){return Y(this,void 0,void 0,function*(){const i=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",n=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),o=n?`?${n}`:"";try{const a=this._getFinalPath(e);return{data:yield(yield Ct(this.fetch,`${this.url}/${i}/${a}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(F(a))return{data:null,error:a};throw a}})}info(e){return Y(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const r=yield Ct(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:bs(r),error:null}}catch(r){if(F(r))return{data:null,error:r};throw r}})}exists(e){return Y(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield Ol(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(F(r)&&r instanceof vs){const i=r.originalError;if([400,404].includes(i==null?void 0:i.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,t){const r=this._getFinalPath(e),i=[],n=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";n!==""&&i.push(n);const a=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",l=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});l!==""&&i.push(l);let d=i.join("&");return d!==""&&(d=`?${d}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${r}${d}`)}}}remove(e){return Y(this,void 0,void 0,function*(){try{return{data:yield jn(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(F(t))return{data:null,error:t};throw t}})}list(e,t,r){return Y(this,void 0,void 0,function*(){try{const i=Object.assign(Object.assign(Object.assign({},Tl),t),{prefix:e||""});return{data:yield we(this.fetch,`${this.url}/object/list/${this.bucketId}`,i,{headers:this.headers},r),error:null}}catch(i){if(F(i))return{data:null,error:i};throw i}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Rl="2.7.1",Al={"X-Client-Info":`storage-js/${Rl}`};var $e=function(s,e,t,r){function i(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(u){try{d(r.next(u))}catch(h){o(h)}}function l(u){try{d(r.throw(u))}catch(h){o(h)}}function d(u){u.done?n(u.value):i(u.value).then(a,l)}d((r=r.apply(s,e||[])).next())})};class Il{constructor(e,t={},r){this.url=e,this.headers=Object.assign(Object.assign({},Al),t),this.fetch=xn(r)}listBuckets(){return $e(this,void 0,void 0,function*(){try{return{data:yield Ct(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(F(e))return{data:null,error:e};throw e}})}getBucket(e){return $e(this,void 0,void 0,function*(){try{return{data:yield Ct(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(F(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return $e(this,void 0,void 0,function*(){try{return{data:yield we(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(F(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return $e(this,void 0,void 0,function*(){try{return{data:yield Pl(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(F(r))return{data:null,error:r};throw r}})}emptyBucket(e){return $e(this,void 0,void 0,function*(){try{return{data:yield we(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(F(t))return{data:null,error:t};throw t}})}deleteBucket(e){return $e(this,void 0,void 0,function*(){try{return{data:yield jn(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(F(t))return{data:null,error:t};throw t}})}}class Ll extends Il{constructor(e,t={},r){super(e,t,r)}from(e){return new Nl(this.url,this.headers,e,this.fetch)}}const Ul="2.45.6";let st="";typeof Deno<"u"?st="deno":typeof document<"u"?st="web":typeof navigator<"u"&&navigator.product==="ReactNative"?st="react-native":st="node";const $l={"X-Client-Info":`supabase-js-${st}/${Ul}`},Dl={headers:$l},Ml={schema:"public"},zl={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Fl={};var Bl=function(s,e,t,r){function i(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(u){try{d(r.next(u))}catch(h){o(h)}}function l(u){try{d(r.throw(u))}catch(h){o(h)}}function d(u){u.done?n(u.value):i(u.value).then(a,l)}d((r=r.apply(s,e||[])).next())})};const Wl=s=>{let e;return s?e=s:typeof fetch>"u"?e=ln:e=fetch,(...t)=>e(...t)},Vl=()=>typeof Headers>"u"?cn:Headers,ql=(s,e,t)=>{const r=Wl(t),i=Vl();return(n,o)=>Bl(void 0,void 0,void 0,function*(){var a;const l=(a=yield e())!==null&&a!==void 0?a:s;let d=new i(o==null?void 0:o.headers);return d.has("apikey")||d.set("apikey",s),d.has("Authorization")||d.set("Authorization",`Bearer ${l}`),r(n,Object.assign(Object.assign({},o),{headers:d}))})};var Hl=function(s,e,t,r){function i(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(u){try{d(r.next(u))}catch(h){o(h)}}function l(u){try{d(r.throw(u))}catch(h){o(h)}}function d(u){u.done?n(u.value):i(u.value).then(a,l)}d((r=r.apply(s,e||[])).next())})};function Gl(s){return s.replace(/\/$/,"")}function Kl(s,e){const{db:t,auth:r,realtime:i,global:n}=s,{db:o,auth:a,realtime:l,global:d}=e,u={db:Object.assign(Object.assign({},o),t),auth:Object.assign(Object.assign({},a),r),realtime:Object.assign(Object.assign({},l),i),global:Object.assign(Object.assign({},d),n),accessToken:()=>Hl(this,void 0,void 0,function*(){return""})};return s.accessToken?u.accessToken=s.accessToken:delete u.accessToken,u}const Sn="2.65.1",Jl="http://localhost:9999",Yl="supabase.auth.token",Ql={"X-Client-Info":`gotrue-js/${Sn}`},dr=10,_s="X-Supabase-Api-Version",En={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}};function Xl(s){return Math.round(Date.now()/1e3)+s}function Zl(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(s){const e=Math.random()*16|0;return(s=="x"?e:e&3|8).toString(16)})}const oe=()=>typeof document<"u",Ce={tested:!1,writable:!1},ot=()=>{if(!oe())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Ce.tested)return Ce.writable;const s=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(s,s),globalThis.localStorage.removeItem(s),Ce.tested=!0,Ce.writable=!0}catch{Ce.tested=!0,Ce.writable=!1}return Ce.writable};function ss(s){const e={},t=new URL(s);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((i,n)=>{e[n]=i})}catch{}return t.searchParams.forEach((r,i)=>{e[i]=r}),e}const Cn=s=>{let e;return s?e=s:typeof fetch>"u"?e=(...t)=>We(async()=>{const{default:r}=await Promise.resolve().then(()=>Ge);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},ec=s=>typeof s=="object"&&s!==null&&"status"in s&&"ok"in s&&"json"in s&&typeof s.json=="function",Pn=async(s,e,t)=>{await s.setItem(e,JSON.stringify(t))},_t=async(s,e)=>{const t=await s.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},yt=async(s,e)=>{await s.removeItem(e)};function tc(s){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let t="",r,i,n,o,a,l,d,u=0;for(s=s.replace("-","+").replace("_","/");u<s.length;)o=e.indexOf(s.charAt(u++)),a=e.indexOf(s.charAt(u++)),l=e.indexOf(s.charAt(u++)),d=e.indexOf(s.charAt(u++)),r=o<<2|a>>4,i=(a&15)<<4|l>>2,n=(l&3)<<6|d,t=t+String.fromCharCode(r),l!=64&&i!=0&&(t=t+String.fromCharCode(i)),d!=64&&n!=0&&(t=t+String.fromCharCode(n));return t}class Ft{constructor(){this.promise=new Ft.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Ft.promiseConstructor=Promise;function hr(s){const e=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,t=s.split(".");if(t.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!e.test(t[1]))throw new Error("JWT is not valid: payload is not in base64url format");const r=t[1];return JSON.parse(tc(r))}async function sc(s){return await new Promise(e=>{setTimeout(()=>e(null),s)})}function rc(s,e){return new Promise((r,i)=>{(async()=>{for(let n=0;n<1/0;n++)try{const o=await s(n);if(!e(n,null,o)){r(o);return}}catch(o){if(!e(n,o)){i(o);return}}})()})}function nc(s){return("0"+s.toString(16)).substr(-2)}function ic(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let i="";for(let n=0;n<56;n++)i+=t.charAt(Math.floor(Math.random()*r));return i}return crypto.getRandomValues(e),Array.from(e,nc).join("")}async function oc(s){const t=new TextEncoder().encode(s),r=await crypto.subtle.digest("SHA-256",t),i=new Uint8Array(r);return Array.from(i).map(n=>String.fromCharCode(n)).join("")}function ac(s){return btoa(s).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function lc(s){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),s;const t=await oc(s);return ac(t)}async function De(s,e,t=!1){const r=ic();let i=r;t&&(i+="/PASSWORD_RECOVERY"),await Pn(s,`${e}-code-verifier`,i);const n=await lc(r);return[n,r===n?"plain":"s256"]}const cc=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function uc(s){const e=s.headers.get(_s);if(!e||!e.match(cc))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}class $s extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function j(s){return typeof s=="object"&&s!==null&&"__isAuthError"in s}class dc extends $s{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}function hc(s){return j(s)&&s.name==="AuthApiError"}class On extends $s{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Le extends $s{constructor(e,t,r,i){super(e,r,i),this.name=t,this.status=r}}class be extends Le{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function fc(s){return j(s)&&s.name==="AuthSessionMissingError"}class rs extends Le{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class wt extends Le{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class kt extends Le{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class fr extends Le{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class ys extends Le{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function ns(s){return j(s)&&s.name==="AuthRetryableFetchError"}class pr extends Le{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}var pc=function(s,e){var t={};for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&e.indexOf(r)<0&&(t[r]=s[r]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(s);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(s,r[i])&&(t[r[i]]=s[r[i]]);return t};const Oe=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),gc=[502,503,504];async function gr(s){var e;if(!ec(s))throw new ys(Oe(s),0);if(gc.includes(s.status))throw new ys(Oe(s),s.status);let t;try{t=await s.json()}catch(n){throw new On(Oe(n),n)}let r;const i=uc(s);if(i&&i.getTime()>=En["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?r=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(r=t.error_code),r){if(r==="weak_password")throw new pr(Oe(t),s.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new be}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((n,o)=>n&&typeof o=="string",!0))throw new pr(Oe(t),s.status,t.weak_password.reasons);throw new dc(Oe(t),s.status||500,r)}const mc=(s,e,t,r)=>{const i={method:s,headers:(e==null?void 0:e.headers)||{}};return s==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),i.body=JSON.stringify(r),Object.assign(Object.assign({},i),t))};async function P(s,e,t,r){var i;const n=Object.assign({},r==null?void 0:r.headers);n[_s]||(n[_s]=En["2024-01-01"].name),r!=null&&r.jwt&&(n.Authorization=`Bearer ${r.jwt}`);const o=(i=r==null?void 0:r.query)!==null&&i!==void 0?i:{};r!=null&&r.redirectTo&&(o.redirect_to=r.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await vc(s,e,t+a,{headers:n,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(l):{data:Object.assign({},l),error:null}}async function vc(s,e,t,r,i,n){const o=mc(e,r,i,n);let a;try{a=await s(t,Object.assign({},o))}catch(l){throw console.error(l),new ys(Oe(l),0)}if(a.ok||await gr(a),r!=null&&r.noResolveJson)return a;try{return await a.json()}catch(l){await gr(l)}}function _e(s){var e;let t=null;wc(s)&&(t=Object.assign({},s),s.expires_at||(t.expires_at=Xl(s.expires_in)));const r=(e=s.user)!==null&&e!==void 0?e:s;return{data:{session:t,user:r},error:null}}function mr(s){const e=_e(s);return!e.error&&s.weak_password&&typeof s.weak_password=="object"&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.message&&typeof s.weak_password.message=="string"&&s.weak_password.reasons.reduce((t,r)=>t&&typeof r=="string",!0)&&(e.data.weak_password=s.weak_password),e}function ke(s){var e;return{data:{user:(e=s.user)!==null&&e!==void 0?e:s},error:null}}function bc(s){return{data:s,error:null}}function _c(s){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:i,verification_type:n}=s,o=pc(s,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:t,hashed_token:r,redirect_to:i,verification_type:n},l=Object.assign({},o);return{data:{properties:a,user:l},error:null}}function yc(s){return s}function wc(s){return s.access_token&&s.refresh_token&&s.expires_in}var kc=function(s,e){var t={};for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&e.indexOf(r)<0&&(t[r]=s[r]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(s);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(s,r[i])&&(t[r[i]]=s[r[i]]);return t};class xc{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=Cn(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await P(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(j(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await P(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:ke})}catch(r){if(j(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=kc(e,["options"]),i=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(i.new_email=r==null?void 0:r.newEmail,delete i.newEmail),await P(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:_c,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(j(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await P(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:ke})}catch(t){if(j(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,i,n,o,a,l;try{const d={nextPage:null,lastPage:0,total:0},u=await P(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(n=(i=e==null?void 0:e.perPage)===null||i===void 0?void 0:i.toString())!==null&&n!==void 0?n:""},xform:yc});if(u.error)throw u.error;const h=await u.json(),f=(o=u.headers.get("x-total-count"))!==null&&o!==void 0?o:0,p=(l=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return p.length>0&&(p.forEach(g=>{const _=parseInt(g.split(";")[0].split("=")[1].substring(0,1)),w=JSON.parse(g.split(";")[1].split("=")[1]);d[`${w}Page`]=_}),d.total=parseInt(f)),{data:Object.assign(Object.assign({},h),d),error:null}}catch(d){if(j(d))return{data:{users:[]},error:d};throw d}}async getUserById(e){try{return await P(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:ke})}catch(t){if(j(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){try{return await P(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:ke})}catch(r){if(j(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){try{return await P(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:ke})}catch(r){if(j(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){try{const{data:t,error:r}=await P(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:i=>({data:{factors:i},error:null})});return{data:t,error:r}}catch(t){if(j(t))return{data:null,error:t};throw t}}async _deleteFactor(e){try{return{data:await P(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(j(t))return{data:null,error:t};throw t}}}const jc={getItem:s=>ot()?globalThis.localStorage.getItem(s):null,setItem:(s,e)=>{ot()&&globalThis.localStorage.setItem(s,e)},removeItem:s=>{ot()&&globalThis.localStorage.removeItem(s)}};function vr(s={}){return{getItem:e=>s[e]||null,setItem:(e,t)=>{s[e]=t},removeItem:e=>{delete s[e]}}}function Sc(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const Me={debug:!!(globalThis&&ot()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Tn extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Ec extends Tn{}async function Cc(s,e,t){Me.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",s,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),Me.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",s)},e),await globalThis.navigator.locks.request(s,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async i=>{if(i){Me.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",s,i.name);try{return await t()}finally{Me.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",s,i.name)}}else{if(e===0)throw Me.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",s),new Ec(`Acquiring an exclusive Navigator LockManager lock "${s}" immediately failed`);if(Me.debug)try{const n=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(n,null,"  "))}catch(n){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",n)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}})}Sc();const Pc={url:Jl,storageKey:Yl,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Ql,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1},et=30*1e3,br=3;async function _r(s,e,t){return await t()}class ct{constructor(e){var t,r;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=ct.nextInstanceID,ct.nextInstanceID+=1,this.instanceID>0&&oe()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const i=Object.assign(Object.assign({},Pc),e);if(this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.persistSession=i.persistSession,this.storageKey=i.storageKey,this.autoRefreshToken=i.autoRefreshToken,this.admin=new xc({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=Cn(i.fetch),this.lock=i.lock||_r,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,i.lock?this.lock=i.lock:oe()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=Cc:this.lock=_r,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?i.storage?this.storage=i.storage:ot()?this.storage=jc:(this.memoryStorage={},this.storage=vr(this.memoryStorage)):(this.memoryStorage={},this.storage=vr(this.memoryStorage)),oe()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(n){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",n)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async n=>{this._debug("received broadcast notification from other tab or client",n),await this._notifyAllSubscribers(n.data.event,n.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Sn}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){try{const e=oe()?await this._isPKCEFlow():!1;if(this._debug("#_initialize()","begin","is PKCE flow",e),e||this.detectSessionInUrl&&this._isImplicitGrantFlow()){const{data:t,error:r}=await this._getSessionFromURL(e);if(r)return this._debug("#_initialize()","error detecting session from URL",r),(r==null?void 0:r.code)==="identity_already_exists"?{error:r}:(await this._removeSession(),{error:r});const{session:i,redirectType:n}=t;return this._debug("#_initialize()","detected session in URL",i,"redirect type",n),await this._saveSession(i),setTimeout(async()=>{n==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",i):await this._notifyAllSubscribers("SIGNED_IN",i)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(e){return j(e)?{error:e}:{error:new On("Unexpected error during initialization",e)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,i;try{const n=await P(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(i=e==null?void 0:e.options)===null||i===void 0?void 0:i.captchaToken}},xform:_e}),{data:o,error:a}=n;if(a||!o)return{data:{user:null,session:null},error:a};const l=o.session,d=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:d,session:l},error:null}}catch(n){if(j(n))return{data:{user:null,session:null},error:n};throw n}}async signUp(e){var t,r,i;try{let n;if("email"in e){const{email:u,password:h,options:f}=e;let p=null,g=null;this.flowType==="pkce"&&([p,g]=await De(this.storage,this.storageKey)),n=await P(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f==null?void 0:f.emailRedirectTo,body:{email:u,password:h,data:(t=f==null?void 0:f.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken},code_challenge:p,code_challenge_method:g},xform:_e})}else if("phone"in e){const{phone:u,password:h,options:f}=e;n=await P(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:h,data:(r=f==null?void 0:f.data)!==null&&r!==void 0?r:{},channel:(i=f==null?void 0:f.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken}},xform:_e})}else throw new wt("You must provide either an email or phone number and a password");const{data:o,error:a}=n;if(a||!o)return{data:{user:null,session:null},error:a};const l=o.session,d=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:d,session:l},error:null}}catch(n){if(j(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithPassword(e){try{let t;if("email"in e){const{email:n,password:o,options:a}=e;t=await P(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:n,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:mr})}else if("phone"in e){const{phone:n,password:o,options:a}=e;t=await P(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:n,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:mr})}else throw new wt("You must provide either an email or phone number and a password");const{data:r,error:i}=t;return i?{data:{user:null,session:null},error:i}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new rs}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:i})}catch(t){if(j(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,r,i,n;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(i=e.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(n=e.options)===null||n===void 0?void 0:n.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){const t=await _t(this.storage,`${this.storageKey}-code-verifier`),[r,i]=(t??"").split("/");try{const{data:n,error:o}=await P(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:_e});if(await yt(this.storage,`${this.storageKey}-code-verifier`),o)throw o;return!n||!n.session||!n.user?{data:{user:null,session:null,redirectType:null},error:new rs}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign(Object.assign({},n),{redirectType:i??null}),error:o})}catch(n){if(j(n))return{data:{user:null,session:null,redirectType:null},error:n};throw n}}async signInWithIdToken(e){try{const{options:t,provider:r,token:i,access_token:n,nonce:o}=e,a=await P(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:i,access_token:n,nonce:o,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:_e}),{data:l,error:d}=a;return d?{data:{user:null,session:null},error:d}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new rs}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:d})}catch(t){if(j(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,r,i,n,o;try{if("email"in e){const{email:a,options:l}=e;let d=null,u=null;this.flowType==="pkce"&&([d,u]=await De(this.storage,this.storageKey));const{error:h}=await P(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(t=l==null?void 0:l.data)!==null&&t!==void 0?t:{},create_user:(r=l==null?void 0:l.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:d,code_challenge_method:u},redirectTo:l==null?void 0:l.emailRedirectTo});return{data:{user:null,session:null},error:h}}if("phone"in e){const{phone:a,options:l}=e,{data:d,error:u}=await P(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(i=l==null?void 0:l.data)!==null&&i!==void 0?i:{},create_user:(n=l==null?void 0:l.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(o=l==null?void 0:l.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:d==null?void 0:d.message_id},error:u}}throw new wt("You must provide either an email or phone number.")}catch(a){if(j(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(e){var t,r;try{let i,n;"options"in e&&(i=(t=e.options)===null||t===void 0?void 0:t.redirectTo,n=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:o,error:a}=await P(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:n}}),redirectTo:i,xform:_e});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");const l=o.session,d=o.user;return l!=null&&l.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),{data:{user:d,session:l},error:null}}catch(i){if(j(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithSSO(e){var t,r,i;try{let n=null,o=null;return this.flowType==="pkce"&&([n,o]=await De(this.storage,this.storageKey)),await P(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((i=e==null?void 0:e.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:n,code_challenge_method:o}),headers:this.headers,xform:bc})}catch(n){if(j(n))return{data:null,error:n};throw n}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new be;const{error:i}=await P(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:i}})}catch(e){if(j(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:r,type:i,options:n}=e,{error:o}=await P(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:i,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}},redirectTo:n==null?void 0:n.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:r,type:i,options:n}=e,{data:o,error:a}=await P(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:i,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}}});return{data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:a}}throw new wt("You must provide either an email or phone number and a type")}catch(t){if(j(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await r,await t()))();return this.pendingInLock.push((async()=>{try{await i}catch{}})()),i}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=t();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const i=[...this.pendingInLock];await Promise.all(i),this.pendingInLock.splice(0,i.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await _t(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at<=Date.now()/1e3:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.storage.isServer){let o=this.suppressGetSessionWarning;e=new Proxy(e,{get:(l,d,u)=>(!o&&d==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and many not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),o=!0,this.suppressGetSessionWarning=!0),Reflect.get(l,d,u))})}return{data:{session:e},error:null}}const{session:i,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{session:null},error:n}:{data:{session:i},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await P(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:ke}):await this._useSession(async t=>{var r,i,n;const{data:o,error:a}=t;if(a)throw a;return!(!((r=o.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new be}:await P(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(n=(i=o.session)===null||i===void 0?void 0:i.access_token)!==null&&n!==void 0?n:void 0,xform:ke})})}catch(t){if(j(t))return fc(t)&&(await this._removeSession(),await yt(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:i,error:n}=r;if(n)throw n;if(!i.session)throw new be;const o=i.session;let a=null,l=null;this.flowType==="pkce"&&e.email!=null&&([a,l]=await De(this.storage,this.storageKey));const{data:d,error:u}=await P(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:l}),jwt:o.access_token,xform:ke});if(u)throw u;return o.user=d.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(r){if(j(r))return{data:{user:null},error:r};throw r}}_decodeJWT(e){return hr(e)}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new be;const t=Date.now()/1e3;let r=t,i=!0,n=null;const o=hr(e.access_token);if(o.exp&&(r=o.exp,i=r<=t),i){const{session:a,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!a)return{data:{user:null,session:null},error:null};n=a}else{const{data:a,error:l}=await this._getUser(e.access_token);if(l)throw l;n={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)}return{data:{user:n.user,session:n},error:null}}catch(t){if(j(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:o,error:a}=t;if(a)throw a;e=(r=o.session)!==null&&r!==void 0?r:void 0}if(!(e!=null&&e.refresh_token))throw new be;const{session:i,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{user:null,session:null},error:n}:i?{data:{user:i.user,session:i},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(j(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e){try{if(!oe())throw new kt("No browser detected.");if(this.flowType==="implicit"&&!this._isImplicitGrantFlow())throw new kt("Not a valid implicit grant flow url.");if(this.flowType=="pkce"&&!e)throw new fr("Not a valid PKCE flow url.");const t=ss(window.location.href);if(e){if(!t.code)throw new fr("No code detected.");const{data:N,error:R}=await this._exchangeCodeForSession(t.code);if(R)throw R;const T=new URL(window.location.href);return T.searchParams.delete("code"),window.history.replaceState(window.history.state,"",T.toString()),{data:{session:N.session,redirectType:null},error:null}}if(t.error||t.error_description||t.error_code)throw new kt(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});const{provider_token:r,provider_refresh_token:i,access_token:n,refresh_token:o,expires_in:a,expires_at:l,token_type:d}=t;if(!n||!a||!o||!d)throw new kt("No session defined in URL");const u=Math.round(Date.now()/1e3),h=parseInt(a);let f=u+h;l&&(f=parseInt(l));const p=f-u;p*1e3<=et&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${p}s, should have been closer to ${h}s`);const g=f-h;u-g>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",g,f,u):u-g<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",g,f,u);const{data:_,error:w}=await this._getUser(n);if(w)throw w;const b={provider_token:r,provider_refresh_token:i,access_token:n,expires_in:h,expires_at:f,refresh_token:o,token_type:d,user:_.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:b,redirectType:t.type},error:null}}catch(t){if(j(t))return{data:{session:null,redirectType:null},error:t};throw t}}_isImplicitGrantFlow(){const e=ss(window.location.href);return!!(oe()&&(e.access_token||e.error_description))}async _isPKCEFlow(){const e=ss(window.location.href),t=await _t(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:i,error:n}=t;if(n)return{error:n};const o=(r=i.session)===null||r===void 0?void 0:r.access_token;if(o){const{error:a}=await this.admin.signOut(o,e);if(a&&!(hc(a)&&(a.status===404||a.status===401||a.status===403)))return{error:a}}return e!=="others"&&(await this._removeSession(),await yt(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=Zl(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,i;try{const{data:{session:n},error:o}=t;if(o)throw o;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",n)),this._debug("INITIAL_SESSION","callback id",e,"session",n)}catch(n){await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",n),console.error(n)}})}async resetPasswordForEmail(e,t={}){let r=null,i=null;this.flowType==="pkce"&&([r,i]=await De(this.storage,this.storageKey,!0));try{return await P(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:i,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(n){if(j(n))return{data:null,error:n};throw n}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(j(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:r,error:i}=await this._useSession(async n=>{var o,a,l,d,u;const{data:h,error:f}=n;if(f)throw f;const p=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await P(this.fetch,"GET",p,{headers:this.headers,jwt:(u=(d=h.session)===null||d===void 0?void 0:d.access_token)!==null&&u!==void 0?u:void 0})});if(i)throw i;return oe()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),{data:{provider:e.provider,url:r==null?void 0:r.url},error:null}}catch(r){if(j(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,i;const{data:n,error:o}=t;if(o)throw o;return await P(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(i=(r=n.session)===null||r===void 0?void 0:r.access_token)!==null&&i!==void 0?i:void 0})})}catch(t){if(j(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return await rc(async i=>(i>0&&await sc(200*Math.pow(2,i-1)),this._debug(t,"refreshing attempt",i),await P(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:_e})),(i,n)=>{const o=200*Math.pow(2,i);return n&&ns(n)&&Date.now()+o-r<et})}catch(r){if(this._debug(t,"error",r),j(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),oe()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const r=await _t(this.storage,this.storageKey);if(this._debug(t,"session from storage",r),!this._isValidSession(r)){this._debug(t,"session is not valid"),r!==null&&await this._removeSession();return}const i=Math.round(Date.now()/1e3),n=((e=r.expires_at)!==null&&e!==void 0?e:1/0)<i+dr;if(this._debug(t,`session has${n?"":" not"} expired with margin of ${dr}s`),n){if(this.autoRefreshToken&&r.refresh_token){const{error:o}=await this._callRefreshToken(r.refresh_token);o&&(console.error(o),ns(o)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){this._debug(t,"error",r),console.error(r);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new be;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const i=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new Ft;const{data:n,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!n.session)throw new be;await this._saveSession(n.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",n.session);const a={session:n.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(n){if(this._debug(i,"error",n),j(n)){const o={session:null,error:n};return ns(n)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(n),n}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(e,t,r=!0){const i=`#_notifyAllSubscribers(${e})`;this._debug(i,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const n=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,t)}catch(l){n.push(l)}});if(await Promise.all(o),n.length>0){for(let a=0;a<n.length;a+=1)console.error(n[a]);throw n[0]}}finally{this._debug(i,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await Pn(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await yt(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&oe()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),et);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const i=Math.floor((r.expires_at*1e3-e)/et);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${et}ms, refresh threshold is ${br} ticks`),i<=br&&await this._callRefreshToken(r.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Tn)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!oe()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const i=[`provider=${encodeURIComponent(t)}`];if(r!=null&&r.redirectTo&&i.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&i.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[n,o]=await De(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(n)}`,code_challenge_method:`${encodeURIComponent(o)}`});i.push(a.toString())}if(r!=null&&r.queryParams){const n=new URLSearchParams(r.queryParams);i.push(n.toString())}return r!=null&&r.skipBrowserRedirect&&i.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${i.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:i,error:n}=t;return n?{data:null,error:n}:await P(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(j(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,i;const{data:n,error:o}=t;if(o)return{data:null,error:o};const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:l,error:d}=await P(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token});return d?{data:null,error:d}:(e.factorType==="totp"&&(!((i=l==null?void 0:l.totp)===null||i===void 0)&&i.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),{data:l,error:null})})}catch(t){if(j(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:i,error:n}=t;if(n)return{data:null,error:n};const{data:o,error:a}=await P(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token});return a?{data:null,error:a}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:a})})}catch(t){if(j(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:i,error:n}=t;return n?{data:null,error:n}:await P(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(j(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const r=(e==null?void 0:e.factors)||[],i=r.filter(o=>o.factor_type==="totp"&&o.status==="verified"),n=r.filter(o=>o.factor_type==="phone"&&o.status==="verified");return{data:{all:r,totp:i,phone:n},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,r;const{data:{session:i},error:n}=e;if(n)return{data:null,error:n};if(!i)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const o=this._decodeJWT(i.access_token);let a=null;o.aal&&(a=o.aal);let l=a;((r=(t=i.user.factors)===null||t===void 0?void 0:t.filter(h=>h.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(l="aal2");const u=o.amr||[];return{data:{currentLevel:a,nextLevel:l,currentAuthenticationMethods:u},error:null}}))}}ct.nextInstanceID=0;const Oc=ct;class Tc extends Oc{constructor(e){super(e)}}var Nc=function(s,e,t,r){function i(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(u){try{d(r.next(u))}catch(h){o(h)}}function l(u){try{d(r.throw(u))}catch(h){o(h)}}function d(u){u.done?n(u.value):i(u.value).then(a,l)}d((r=r.apply(s,e||[])).next())})};class Rc{constructor(e,t,r){var i,n,o;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const a=Gl(e);this.realtimeUrl=`${a}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${a}/auth/v1`,this.storageUrl=`${a}/storage/v1`,this.functionsUrl=`${a}/functions/v1`;const l=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,d={db:Ml,realtime:Fl,auth:Object.assign(Object.assign({},zl),{storageKey:l}),global:Dl},u=Kl(r??{},d);this.storageKey=(i=u.auth.storageKey)!==null&&i!==void 0?i:"",this.headers=(n=u.global.headers)!==null&&n!==void 0?n:{},u.accessToken?(this.accessToken=u.accessToken,this.auth=new Proxy({},{get:(h,f)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(f)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=u.auth)!==null&&o!==void 0?o:{},this.headers,u.global.fetch),this.fetch=ql(t,this._getAccessToken.bind(this),u.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},u.realtime)),this.rest=new ol(`${a}/rest/v1`,{headers:this.headers,schema:u.db.schema,fetch:this.fetch}),u.accessToken||this._listenForAuthEvents()}get functions(){return new Ua(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new Ll(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return Nc(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:i,storageKey:n,flowType:o,lock:a,debug:l},d,u){var h;const f={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Tc({url:this.authUrl,headers:Object.assign(Object.assign({},f),d),storageKey:n,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:i,flowType:o,lock:a,debug:l,fetch:u,hasCustomAuthorizationHeader:(h="Authorization"in this.headers)!==null&&h!==void 0?h:!1})}_initRealtimeClient(e){return new wl(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r==null?void 0:r.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?(this.realtime.setAuth(r??null),this.changedAccessToken=r):e==="SIGNED_OUT"&&(this.realtime.setAuth(this.supabaseKey),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Ac=(s,e,t)=>new Rc(s,e,t),Ic="https://kbjsoxskzaqpwdwescqc.supabase.co",Lc="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtianNveHNremFxcHdkd2VzY3FjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mjk4NjkwMjUsImV4cCI6MjA0NTQ0NTAyNX0.vfACJetzXSntZzaekcXkrwlP1BjDM7SkMRSp4x5pQKU",Te=Ac(Ic,Lc,{auth:{autoRefreshToken:!1,persistSession:!1,detectSessionInUrl:!1},global:{headers:{"X-Client-Info":"supabase-js/2.x"}}});function yr(s,e,t,r){const n=(t-s)*Math.PI/180,o=(r-e)*Math.PI/180,a=Math.sin(n/2)*Math.sin(n/2)+Math.cos(s*Math.PI/180)*Math.cos(t*Math.PI/180)*Math.sin(o/2)*Math.sin(o/2);return 6371*(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)))}function Uc(){const[s,e]=m.useState(!1);return{findNearby:async(r,i,n=25,o)=>{e(!0),console.group(" Locksmith Search");try{console.log("Search Parameters:",{searchLocation:{latitude:r,longitude:i},radiusKm:n,serviceType:o||"any"});const{data:a,error:l}=await Te.from("profiles").select("*").eq("share_location",!0).not("latitude","is",null).not("longitude","is",null);if(l)throw console.error("Database query error:",l),l;console.log(`Found ${(a==null?void 0:a.length)||0} active profiles`);const u=((a==null?void 0:a.filter(h=>{if(!h.latitude||!h.longitude)return console.log(`Skipping ${h.company_name}: Missing coordinates`),!1;const f=yr(r,i,Number(h.latitude),Number(h.longitude)),p=f<=(h.service_radius||n);return console.log(`${h.company_name}: ${f.toFixed(2)}km - ${p?"IN RANGE":"OUT OF RANGE"}`),p}))||[]).map(h=>{const f=yr(r,i,Number(h.latitude),Number(h.longitude));return{id:h.id,companyName:h.company_name||"Unknown Company",telephoneNumber:h.telephone_number||"",website:h.website||void 0,servicesOffered:[],latitude:Number(h.latitude),longitude:Number(h.longitude),serviceRadius:h.service_radius||n,eta:Math.round(f*2+10)}});return console.log(`Returning ${u.length} locksmiths`),u}catch(a){throw console.error("Search error:",a),a}finally{console.groupEnd(),e(!1)}},loading:s}}const $c=12,wr=50,tt={latitude:54.093409,longitude:-2.89479,zoom:5};function Dc(){const s=m.useRef(null),[e]=Un(),t=ws(),{mapboxToken:r}=Ta(),{findNearby:i,loading:n}=Uc(),[o,a]=m.useState(e.get("postcode")||""),[l,d]=m.useState("home"),[u,h]=m.useState([]),[f,p]=m.useState(null),[g,_]=m.useState(tt),[w,b]=m.useState(!1),[N,R]=m.useState(!1),[T,O]=m.useState(null),[B,x]=m.useState(null),C=(E,A)=>{if(!s.current)return;if(A.length===0){s.current.flyTo({center:[E.longitude,E.latitude],zoom:$c,duration:2e3});return}const M=new Xn.LngLatBounds([E.longitude,E.latitude],[E.longitude,E.latitude]);A.forEach(ne=>{M.extend([ne.longitude,ne.latitude])}),x(M),s.current.fitBounds(M,{padding:wr,duration:2e3})},L=async E=>{if(!(!E.trim()||!r)){R(!0),b(!0),p(null),h([]),O(null);try{const A=await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(E)}.json?country=GB&types=postcode&access_token=${r}`);if(!A.ok)throw new Error(`Geocoding failed: ${A.statusText}`);const M=await A.json();if(!M.features||M.features.length===0)throw new Error("Invalid postcode");const[ne,ie]=M.features[0].center,Se={latitude:ie,longitude:ne};O(Se);const te=await i(ie,ne,25,l);h(te),C(Se,te),te.length===0&&X.info("No locksmiths found in your area")}catch(A){console.error("Search error:",A),X.error(A instanceof Error?A.message:"Search failed"),h([])}finally{R(!1)}}},D=E=>{E.preventDefault(),o.trim()&&(t(`/find?postcode=${encodeURIComponent(o.trim())}`),L(o.trim()))},V=()=>{a(""),d("home"),b(!1),p(null),h([]),_(tt),O(null),x(null),s.current&&s.current.flyTo({center:[tt.longitude,tt.latitude],zoom:tt.zoom,duration:2e3}),t("/find")},H=E=>{p(E),s.current&&s.current.flyTo({center:[E.longitude,E.latitude],zoom:14,duration:2e3})},ee=()=>{p(null),s.current&&B&&s.current.fitBounds(B,{padding:wr,duration:2e3})};return m.useEffect(()=>{const E=e.get("postcode");E&&!w&&L(E)},[e,w]),c.jsxs("div",{className:"relative w-full h-screen",children:[c.jsx(ja,{mapRef:s,viewport:g,onMove:E=>_(E.viewState),hasSearched:w,availableLocksmiths:u,onMarkerClick:H,searchLocation:T}),c.jsx(Sa,{postcode:o,service:l,searching:n||N,onPostcodeChange:a,onServiceChange:d,onSubmit:D}),c.jsx(Oa,{hasSearched:w,selectedLocksmith:f,availableLocksmiths:u,onLocksmithSelect:H,onBack:ee,onReset:V})]})}const Mc=m.createContext(null),is={didCatch:!1,error:null};class zc extends m.Component{constructor(e){super(e),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=is}static getDerivedStateFromError(e){return{didCatch:!0,error:e}}resetErrorBoundary(){const{error:e}=this.state;if(e!==null){for(var t,r,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];(t=(r=this.props).onReset)===null||t===void 0||t.call(r,{args:n,reason:"imperative-api"}),this.setState(is)}}componentDidCatch(e,t){var r,i;(r=(i=this.props).onError)===null||r===void 0||r.call(i,e,t)}componentDidUpdate(e,t){const{didCatch:r}=this.state,{resetKeys:i}=this.props;if(r&&t.error!==null&&Fc(e.resetKeys,i)){var n,o;(n=(o=this.props).onReset)===null||n===void 0||n.call(o,{next:i,prev:e.resetKeys,reason:"keys"}),this.setState(is)}}render(){const{children:e,fallbackRender:t,FallbackComponent:r,fallback:i}=this.props,{didCatch:n,error:o}=this.state;let a=e;if(n){const l={error:o,resetErrorBoundary:this.resetErrorBoundary};if(typeof t=="function")a=t(l);else if(r)a=m.createElement(r,l);else if(i!==void 0)a=i;else throw o}return m.createElement(Mc.Provider,{value:{didCatch:n,error:o,resetErrorBoundary:this.resetErrorBoundary}},a)}}function Fc(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return s.length!==e.length||s.some((t,r)=>!Object.is(t,e[r]))}function Bc({error:s,resetErrorBoundary:e}){return console.error("Error caught by boundary:",s),c.jsx("div",{className:"flex items-center justify-center h-screen",children:c.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",role:"alert",children:[c.jsx("strong",{className:"font-bold",children:"Error:"}),c.jsxs("span",{className:"block sm:inline",children:[" ",s.message]}),c.jsx("pre",{className:"mt-2 text-sm",children:s.stack}),c.jsx("button",{onClick:e,className:"mt-4 bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded",children:"Try again"})]})})}function Wc({children:s}){return c.jsx(zc,{FallbackComponent:Bc,onError:(e,t)=>{console.error("Error caught by boundary:",e,t)},children:s})}function Vc(){return c.jsx(Wc,{children:c.jsx("main",{className:"w-full h-screen",children:c.jsx(Dc,{})})})}function Nn(){return c.jsx("div",{className:"min-h-screen flex items-center justify-center",children:c.jsxs("div",{className:"flex flex-col items-center gap-4",children:[c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"}),c.jsx("p",{className:"text-base-content/60",children:"Loading..."})]})})}function qc({children:s}){const{isLoaded:e,isSignedIn:t}=an(),r=$n();return e?t?c.jsx(c.Fragment,{children:s}):c.jsx(Dn,{to:"/sign-in",state:{from:r},replace:!0}):c.jsx(Nn,{})}function ht(){const[s,e]=m.useState(null),[t,r]=m.useState(!0),[i,n]=m.useState(null),{user:o,isSignedIn:a}=nn(),{getToken:l}=an(),d=async()=>{if(!a||!o)throw console.log("No authenticated user:",{isSignedIn:a,userId:o==null?void 0:o.id}),new Error("No authenticated user");try{console.log("Getting token from Clerk...");const f=await l({template:"supabase",skipCache:!0});if(!f)throw console.error("No token received from Clerk"),new Error("Failed to get Supabase token");console.log("Token received:",{length:f.length,preview:`${f.slice(0,20)}...${f.slice(-20)}`}),Te.rest.headers.Authorization=`Bearer ${f}`;const{data:p}=await Te.from("profiles").select("count");return console.log("Connection test:",p),f}catch(f){throw console.error("Auth setup error:",{error:f,message:f instanceof Error?f.message:"Unknown error"}),f}},u=async()=>{if(!a||!o){console.log("No authenticated user in loadProfile"),r(!1);return}try{await d(),console.log("Fetching profile for user:",o.id);const{data:f,error:p}=await Te.from("profiles").select().eq("id",o.id).maybeSingle();if(p)throw console.error("Profile fetch error:",p),p;if(f)console.log("Found existing profile:",f),e(f);else{console.log("Creating new profile...");const g={id:o.id,company_name:o.publicMetadata.company_name||null,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),country:"United Kingdom",service_radius:10,share_location:!1};console.log("New profile data:",g);const{data:_,error:w}=await Te.from("profiles").insert([g]).select().single();if(w)throw console.error("Profile creation error:",w),w;console.log("New profile created:",_),e(_)}n(null)}catch(f){console.error("Profile loading error:",f),n(f instanceof Error?f:new Error("Failed to load profile")),X.error("Failed to load profile")}finally{r(!1)}},h=async f=>{if(!a||!o)throw new Error("Not authenticated");try{await d(),console.log("Updating profile:",f);const{data:p,error:g}=await Te.from("profiles").update({...f,updated_at:new Date().toISOString()}).eq("id",o.id).select().single();if(g)throw console.error("Profile update error:",g),g;return console.log("Profile updated:",p),e(p),n(null),X.success("Profile updated successfully"),p}catch(p){console.error("Profile update error:",p);const g=p instanceof Error?p.message:"Failed to update profile";throw n(new Error(g)),X.error(g),p}};return m.useEffect(()=>{console.log("useEffect triggered with:",{isSignedIn:a,userId:o==null?void 0:o.id}),u()},[o,a]),{profile:s,loading:t,error:i,updateProfile:h,isInitialized:!t,testAuth:async()=>{try{const{data:f}=await Te.rpc("debug_auth_state");return console.log("testAuth result:",f),f}catch(f){return console.error("Auth test failed:",f),null}}}}function Hc(){const{profile:s,loading:e,updateProfile:t}=ht(),[r,i]=m.useState(!1),[n,o]=m.useState({company_name:"",telephone_number:"",website:"",address_line1:"",address_line2:"",city:"",county:"",postcode:"",country:"United Kingdom"});m.useEffect(()=>{s&&o({company_name:s.company_name||"",telephone_number:s.telephone_number||"",website:s.website||"",address_line1:s.address_line1||"",address_line2:s.address_line2||"",city:s.city||"",county:s.county||"",postcode:s.postcode||"",country:s.country||"United Kingdom"})},[s]);const a=(d,u)=>{o(h=>({...h,[d]:u}))},l=async d=>{d.preventDefault(),i(!0);try{await t(n)}finally{i(!1)}};return e?c.jsx("div",{className:"flex items-center justify-center p-6",children:c.jsx(Hs,{className:"h-6 w-6 animate-spin"})}):c.jsxs("form",{onSubmit:l,className:"space-y-4",children:[c.jsxs("div",{className:"form-control",children:[c.jsx("label",{className:"label",children:c.jsx("span",{className:"label-text",children:"Company Name"})}),c.jsx("input",{type:"text",className:"input input-bordered",value:n.company_name||"",onChange:d=>a("company_name",d.target.value),required:!0,disabled:r})]}),c.jsxs("div",{className:"form-control",children:[c.jsx("label",{className:"label",children:c.jsx("span",{className:"label-text",children:"Contact Telephone Number"})}),c.jsx("input",{type:"tel",className:"input input-bordered",value:n.telephone_number||"",onChange:d=>a("telephone_number",d.target.value),required:!0,disabled:r})]}),c.jsxs("div",{className:"form-control",children:[c.jsx("label",{className:"label",children:c.jsx("span",{className:"label-text",children:"Website (Optional)"})}),c.jsx("input",{type:"url",className:"input input-bordered",value:n.website||"",onChange:d=>a("website",d.target.value),disabled:r})]}),c.jsxs("div",{className:"form-control",children:[c.jsx("label",{className:"label",children:c.jsx("span",{className:"label-text",children:"Address Line 1"})}),c.jsx("input",{type:"text",className:"input input-bordered",value:n.address_line1||"",onChange:d=>a("address_line1",d.target.value),required:!0,disabled:r})]}),c.jsxs("div",{className:"form-control",children:[c.jsx("label",{className:"label",children:c.jsx("span",{className:"label-text",children:"Address Line 2 (Optional)"})}),c.jsx("input",{type:"text",className:"input input-bordered",value:n.address_line2||"",onChange:d=>a("address_line2",d.target.value),disabled:r})]}),c.jsxs("div",{className:"form-control",children:[c.jsx("label",{className:"label",children:c.jsx("span",{className:"label-text",children:"City"})}),c.jsx("input",{type:"text",className:"input input-bordered",value:n.city||"",onChange:d=>a("city",d.target.value),required:!0,disabled:r})]}),c.jsxs("div",{className:"form-control",children:[c.jsx("label",{className:"label",children:c.jsx("span",{className:"label-text",children:"County"})}),c.jsx("input",{type:"text",className:"input input-bordered",value:n.county||"",onChange:d=>a("county",d.target.value),required:!0,disabled:r})]}),c.jsxs("div",{className:"form-control",children:[c.jsx("label",{className:"label",children:c.jsx("span",{className:"label-text",children:"Postcode"})}),c.jsx("input",{type:"text",className:"input input-bordered",value:n.postcode||"",onChange:d=>a("postcode",d.target.value),required:!0,disabled:r})]}),c.jsx("button",{type:"submit",className:`btn btn-primary w-full ${r?"loading":""}`,disabled:r,children:r?c.jsxs(c.Fragment,{children:[c.jsx(Hs,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):"Save Changes"})]})}function Gc(){const{profile:s,loading:e,updateProfile:t}=ht(),[r,i]=m.useState(!1),[n,o]=m.useState({service_radius:10,share_location:!1,postcode:"",latitude:null,longitude:null});m.useEffect(()=>{s&&o({service_radius:s.service_radius||10,share_location:s.share_location||!1,postcode:s.postcode||"",latitude:s.latitude,longitude:s.longitude})},[s]);const a=async l=>{l.preventDefault(),i(!0),console.group("Service Area Update");try{const d="pk.eyJ1IjoibWlzdGVyY3JlYXNlIiwiYSI6ImNtMmV0d20xNTAyODgyaXNjNTg4MHZobHUifQ.6wMDQBDPbrNzRUCE4l035g",u=await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(n.postcode)}.json?country=GB&types=postcode&access_token=${d}`);if(!u.ok)throw new Error(`Geocoding failed: ${u.statusText}`);const h=await u.json();if(!h.features||h.features.length===0)throw new Error("Invalid postcode");const[f,p]=h.features[0].center;await t({service_radius:n.service_radius,share_location:n.share_location,postcode:n.postcode,latitude:p,longitude:f,updated_at:new Date().toISOString()}),o(g=>({...g,latitude:p,longitude:f})),X.success("Service area settings updated successfully")}catch(d){console.error("Error updating service area:",d),X.error(d instanceof Error?d.message:"Failed to update service area")}finally{console.groupEnd(),i(!1)}};return e?c.jsx("span",{className:"loading loading-spinner loading-lg"}):c.jsxs("div",{className:"space-y-6",children:[n.latitude&&n.longitude?c.jsxs("div",{className:"alert alert-success",children:[c.jsx(Ot,{className:"h-4 w-4"}),c.jsxs("span",{children:["Current location: ",n.latitude.toFixed(6),", ",n.longitude.toFixed(6)]})]}):c.jsxs("div",{className:"alert alert-warning",children:[c.jsx(Er,{className:"h-4 w-4"}),c.jsx("span",{children:"No location set. Please enter your business postcode."})]}),c.jsxs("form",{onSubmit:a,className:"space-y-6",children:[c.jsxs("div",{className:"form-control",children:[c.jsx("label",{className:"label",children:c.jsx("span",{className:"label-text",children:"Business Postcode"})}),c.jsx("input",{type:"text",className:"input input-bordered",value:n.postcode,onChange:l=>o(d=>({...d,postcode:l.target.value})),placeholder:"e.g., M4 7AZ",required:!0})]}),c.jsxs("div",{className:"form-control",children:[c.jsx("label",{className:"label",children:c.jsxs("span",{className:"label-text",children:["Service Radius: ",n.service_radius," km"]})}),c.jsx("input",{type:"range",min:1,max:50,value:n.service_radius,onChange:l=>o(d=>({...d,service_radius:Number(l.target.value)})),className:"range range-primary",step:1}),c.jsxs("div",{className:"w-full flex justify-between text-xs px-2",children:[c.jsx("span",{children:"1km"}),c.jsx("span",{children:"25km"}),c.jsx("span",{children:"50km"})]})]}),c.jsxs("div",{className:"form-control",children:[c.jsxs("label",{className:"label cursor-pointer",children:[c.jsx("span",{className:"label-text",children:"Share Live Location During Working Hours"}),c.jsx("input",{type:"checkbox",className:"toggle toggle-primary",checked:n.share_location,onChange:l=>o(d=>({...d,share_location:l.target.checked}))})]}),c.jsx("label",{className:"label",children:c.jsx("span",{className:"label-text-alt text-warning",children:"You must enable this to appear in search results"})})]}),c.jsx("button",{type:"submit",className:`btn btn-primary w-full ${r?"loading":""}`,disabled:r,children:r?"Saving...":"Save Changes"})]}),c.jsx("div",{className:"divider",children:"Debug Information"}),c.jsxs("div",{className:"space-y-2 text-sm font-mono",children:[c.jsx("p",{children:"Current State:"}),c.jsx("pre",{className:"bg-base-200 p-4 rounded-lg overflow-x-auto",children:JSON.stringify({profile_id:s==null?void 0:s.id,current:{share_location:s==null?void 0:s.share_location,latitude:s==null?void 0:s.latitude,longitude:s==null?void 0:s.longitude,service_radius:s==null?void 0:s.service_radius,postcode:s==null?void 0:s.postcode},form:n},null,2)})]})]})}const kr=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],xr=["Closed","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00"];function Kc(){const{loading:s}=ht(),[e,t]=m.useState({}),[r,i]=m.useState(!1);m.useEffect(()=>{const o=kr.reduce((a,l)=>({...a,[l]:{start_time:l==="sunday"?null:"09:00",end_time:l==="sunday"?null:"17:00",is_closed:l==="sunday"}}),{});t(o)},[]);const n=async(o,a,l)=>{const d=l==="Closed",u={...e[o],[a]:d?null:l,is_closed:d&&a==="start_time"?!0:e[o].is_closed};t(h=>({...h,[o]:u}));try{i(!0),X.success(`Updated ${o}'s hours`)}catch{X.error(`Failed to update ${o}'s hours`)}finally{i(!1)}};return s?c.jsx("span",{className:"loading loading-spinner loading-lg"}):c.jsx("div",{className:"space-y-6",children:kr.map(o=>{var a,l,d;return c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("span",{className:"w-24 capitalize",children:o}),c.jsx("select",{className:"select select-bordered flex-1",value:((a=e[o])==null?void 0:a.start_time)||"Closed",onChange:u=>n(o,"start_time",u.target.value),disabled:r,children:xr.map(u=>c.jsx("option",{value:u,children:u},u))}),c.jsx("span",{children:"to"}),c.jsx("select",{className:"select select-bordered flex-1",value:((l=e[o])==null?void 0:l.end_time)||"Closed",onChange:u=>n(o,"end_time",u.target.value),disabled:((d=e[o])==null?void 0:d.start_time)==="Closed"||r,children:xr.map(u=>c.jsx("option",{value:u,children:u},u))})]},o)})})}const Jc=[{name:"Callout Fee",price:0},{name:"Home Lockout",price:0},{name:"Car Lockout",price:0},{name:"Lock Change",price:0},{name:"Lock Repair",price:0},{name:"Key Cutting",price:0},{name:"Safe Opening",price:0},{name:"Security Survey",price:0}];function Yc(){const{loading:s}=ht(),[e,t]=m.useState(Jc.map(a=>({...a,is_offered:!0}))),[r,i]=m.useState(!1),n=async a=>{if(e.find(d=>d.id===a))try{i(!0);const d=e.map(u=>u.id===a?{...u,is_offered:!u.is_offered}:u);t(d),X.success("Service updated successfully")}catch{X.error("Failed to update service")}finally{i(!1)}},o=async(a,l)=>{try{i(!0);const d=e.map(u=>u.id===a?{...u,price:parseFloat(l)||0}:u);t(d),X.success("Price updated successfully")}catch{X.error("Failed to update price")}finally{i(!1)}};return s?c.jsx("span",{className:"loading loading-spinner loading-lg"}):c.jsxs("div",{className:"space-y-6",children:[c.jsx("div",{className:"alert alert-info",children:c.jsx("span",{children:"Set your service prices and toggle which services you offer."})}),e.map(a=>c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("label",{className:"label cursor-pointer",children:c.jsx("input",{type:"checkbox",className:"toggle toggle-primary",checked:a.is_offered,onChange:()=>a.id&&n(a.id),disabled:r})}),c.jsx("span",{className:"flex-1 font-medium",children:a.name}),c.jsxs("div",{className:"join",children:[c.jsx("span",{className:"join-item flex items-center px-3 bg-base-200",children:c.jsx(Kn,{className:"h-4 w-4"})}),c.jsx("input",{type:"number",min:"0",step:"0.01",value:a.price,onChange:l=>a.id&&o(a.id,l.target.value),className:"input input-bordered join-item w-24 text-right",placeholder:"0.00",disabled:!a.is_offered||r})]})]},a.id||a.name))]})}function Qc(){const[s,e]=m.useState("company");return c.jsxs("div",{className:"w-full",children:[c.jsxs("div",{className:"tabs tabs-boxed justify-center mb-6",children:[c.jsx("button",{className:`tab ${s==="company"?"tab-active":""}`,onClick:()=>e("company"),children:"Company Details"}),c.jsx("button",{className:`tab ${s==="service"?"tab-active":""}`,onClick:()=>e("service"),children:"Service Area"}),c.jsx("button",{className:`tab ${s==="hours"?"tab-active":""}`,onClick:()=>e("hours"),children:"Working Hours"}),c.jsx("button",{className:`tab ${s==="prices"?"tab-active":""}`,onClick:()=>e("prices"),children:"Services & Prices"})]}),c.jsx("div",{className:"card bg-base-100 shadow-xl",children:c.jsxs("div",{className:"card-body",children:[s==="company"&&c.jsx(Hc,{}),s==="service"&&c.jsx(Gc,{}),s==="hours"&&c.jsx(Kc,{}),s==="prices"&&c.jsx(Yc,{})]})})]})}function Xc(){const s=ws(),{user:e,isLoaded:t}=nn(),{profile:r,loading:i,error:n}=ht();return m.useEffect(()=>{t&&!e&&s("/locksmith/login")},[e,t,s]),m.useEffect(()=>{n&&(console.error("Dashboard error:",n),X.error("Failed to load dashboard. Please try again."))},[n]),!t||i?c.jsx(Nn,{}):!e||!r?null:c.jsxs("div",{className:"container mx-auto p-4 space-y-6",children:[c.jsxs("div",{className:"flex justify-between items-center",children:[c.jsxs("div",{children:[c.jsx("h1",{className:"text-3xl font-bold",children:"Locksmith Dashboard"}),c.jsx("p",{className:"text-base-content/60",children:r.company_name||"Complete your profile"})]}),c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsxs(pe,{to:"/",className:"btn btn-outline",children:[c.jsx(Tt,{className:"w-4 h-4 mr-2"}),"Home"]}),c.jsxs("button",{className:"btn btn-outline",onClick:()=>{s("/")},children:[c.jsx(Jn,{className:"w-4 h-4 mr-2"}),"Logout"]})]})]}),c.jsx(Qc,{})]})}function Zc(){return m.useEffect(()=>{const s=()=>{document.body.removeAttribute("data-new-gr-c-s-check-loaded"),document.body.removeAttribute("data-gr-ext-installed")};return s(),window.addEventListener("load",s),()=>{window.removeEventListener("load",s)}},[]),null}function eu(){return c.jsx(Mn,{children:c.jsxs(ga,{children:[c.jsx(Yn,{position:"top-right",richColors:!0}),c.jsxs(zn,{children:[c.jsx(Ye,{path:"/",element:c.jsx(xa,{})}),c.jsx(Ye,{path:"/find",element:c.jsx(Vc,{})}),c.jsx(Ye,{path:"/sign-in/*",element:c.jsx("div",{className:"min-h-screen flex items-center justify-center",children:c.jsx(Yo,{routing:"path",path:"/sign-in"})})}),c.jsx(Ye,{path:"/sign-up/*",element:c.jsx("div",{className:"min-h-screen flex items-center justify-center",children:c.jsx(Qo,{routing:"path",path:"/sign-up"})})}),c.jsx(Ye,{path:"/locksmith/dashboard/*",element:c.jsx(qc,{children:c.jsx(Xc,{})})})]}),c.jsx(Zc,{})]})})}const tu="pk_test_dHJ1ZS1sb2N1c3QtNy5jbGVyay5hY2NvdW50cy5kZXYk";os.createRoot(document.getElementById("root")).render(c.jsx(v.StrictMode,{children:c.jsx(rn,{publishableKey:tu,afterSignInUrl:"/locksmith/dashboard",afterSignUpUrl:"/locksmith/dashboard",signInUrl:"/sign-in",signUpUrl:"/sign-up",children:c.jsx(eu,{})})}));
//# sourceMappingURL=index-ClzS9qef.js.map
